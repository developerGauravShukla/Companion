"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[811],{811:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Q});var o=a(5043),n=a(4391),s=(a(2342),a(9555),a(3003)),l=a(2670),i=a(2115),r=(a(8421),a(4050),a(9959),a(174)),c=a(2725),d=a(3277),u=a(6713),m=a(5645),p=a(9379),g=a(6047);const h=async(e,t,a)=>{try{const a="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let o=[];console.log("[All Plant Service] CollabSpaces: ",e),console.log("[All Plant Service] headers: ",t);const n=await(0,g.fV)(),s=async e=>new Promise(((a,o)=>{n.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),a(e)},onFailure:e=>{console.error("Request failed:",e),o(e)}})})),l=e.map((async e=>{try{var t,n;const c="".concat(a,"/resources/v1/modeler/dslib/dslib:Library/search?$searchStr=").concat(e),d=null===(t=(await s(c)).member)||void 0===t||null===(n=t.find((t=>t.title===e)))||void 0===n?void 0:n.id;if(console.log("[All Plant Service] Library id is:",d),d){const e="".concat(a,"/resources/v1/modeler/dslib/dslib:Library/").concat(d,"?$mask=dslib:ExpandClassifiableClassesMask"),t=await s(e),{member:n}=t;if(n&&n.length>0){var l,i;console.log("[Library Data Service] Member found:",n);const e=null===(l=n[0])||void 0===l?void 0:l.ChildClasses;if((null===e||void 0===e||null===(i=e.member)||void 0===i?void 0:i.length)>0){var r;const t=null===(r=e.member[0].ChildClasses)||void 0===r?void 0:r.member;if(t&&t.length>0){const e=t.filter((e=>!o.some((t=>t.id===e.id))));o=[...o,...e]}}}}}catch(c){throw console.error("Error processing group:",e,c),c}}));return await Promise.all(l),o}catch(o){throw console.error("[All Plant Service] Error occurred:",o),o}},v=async(e,t)=>{let a={CAAtt:[]};console.log("We are into Search CA Details");const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";try{const s=await(0,g.fV)(),l=async e=>new Promise(((a,o)=>{s.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),a(e)},onFailure:e=>{console.error("Request failed:",e),o(e)}})}));let i="".concat(o,"/resources/v1/modeler/dsrt/routes/search?searchStr=").concat(e);const r=await l(i),c=((null===r||void 0===r?void 0:r.data)||[]).find((e=>"Route"===e.type));if(c){const t=c.identifier,n=c.state,s="".concat(o,"/resources/v1/modeler/dsrt/routes/").concat(t),i=await l(s),r=((null===i||void 0===i?void 0:i.data)||[]).find((e=>"Change Action"===e.type));if(r){const e=r.identifier,t="".concat(o,"/resources/v1/modeler/dslc/changeaction/").concat(e,"?$fields=proposedChanges,flowDown"),n=await l(t);if(n)for(const s of n.isFlowDownOf||[])if("Change Action"===s.type){const e="".concat(o,"/resources/v1/modeler/dslc/changeaction/").concat(s.identifier),t=await l(e);t&&a.CAAtt.push({CATitle:t.title,CAState:t.state})}}a.MCOState=n,a.MCOTitle=e}else{var n;const t=e.split("-").slice(0,2).join("-");let s="".concat(o,"/resources/v1/modeler/dslc/changeaction/search?$searchStr=name:").concat(t);const i=null===(n=(await l(s)).changeAction[0])||void 0===n?void 0:n.identifier,r="".concat(o,"/resources/v1/modeler/dslc/changeaction/").concat(i,"?$fields=proposedChanges,flowDown"),c=await l(r);if(c)for(const e of c.isFlowDownOf||[])if("Change Action"===e.type){const t="".concat(o,"/resources/v1/modeler/dslc/changeaction/").concat(e.identifier),n=await l(t);n&&a.CAAtt.push({CATitle:n.title,CAState:n.state})}a.MCOState="Complete",a.MCOTitle=e}return console.log("Final CA Details",a),a}catch(s){throw console.error("Error in SearchCA:",s),s}};var f=a(9722);const A=async(e,t,a,o,n)=>{try{const t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",o=await async function(e,t,a){const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",n="".concat(o,"/resources/v1/modeler/dslc/version/getGraph");let s="";try{const l={data:[{id:e,identifier:e,type:t,source:o,relativePath:"Raw_Material"===t?"/resources/v1/modeler/dsrm/dsrm:RawMaterial/".concat(e):"/resources/v1/modeler/dseng/dseng:EngItem/".concat(e)}]},i=await(0,g.ui)("POST",n,l,a);if(i.status&&i.output){const t=i.output.results[0].versions;for(const a of t)if(a.identifier===e&&(console.log("Found matching version for ID:",e),Array.isArray(a.ancestors)&&a.ancestors.length>0)){s=a.ancestors[0].id,console.log("Ancestor ID:",s);break}return s}return console.error("API response does not contain the expected 'status' and 'output'."),s}catch(l){return console.error("Error fetching getLatestRevision for ".concat(e,":"),l),s}}(a,n,e);if(console.log("Hello getLatestRevision is Called",o),""===o)return console.warn("No latest revision ID found."),[];{const r="".concat(t,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(o,"?$mask=dslib:ClassificationAttributesMask"),c=await(0,g.ui)("GET",r,"",e);if(!c.status||!c.output)return console.error("Invalid classification response from ENOVIA."),[];{var s,l;const e=((null===(s=c.output.member[0])||void 0===s||null===(l=s.ClassificationAttributes)||void 0===l?void 0:l.member)||[]).filter((e=>e.Attributes.some((e=>"PlantAssignmentClass"===e.name&&!0===e.value)))).map((e=>{const t=e.Attributes.map((e=>"Seq"===e.name?{name:e.name,value:String(Number(e.value)+1)}:"PlantStatus"===e.name?{name:e.name,value:"Pending"}:"AddSeq"===e.name||"PlantAssignmentClass"===e.name?{name:e.name,value:e.value}:{name:e.name,value:""}));return{ClassID:e.ClassID,Attributes:t}}));if(console.log("Matching ClassID and Seq:",e),!(e.length>0))return console.warn("No matching classifications found with Plant = True."),[];{const o="https://saasimplementationserverdev.azurewebsites.net/plantAssignment/classifyProductToClass",s={id:a,type:n,classes:e.map((e=>e.ClassID)),mode:"classifyParent"};try{const n=await C("POST",o,s);console.log("classifyResponse:",JSON.stringify(n));const l={source:t,type:"dslib:CategorizationClassifiedItem",identifier:a,relativePath:"resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/".concat(a)},i=[{referencedObject:l,categorizationAttributes:e.map((e=>({classId:e.ClassID,attributes:e.Attributes.reduce(((e,t)=>(e[t.name]=t.value,e)),{})})))}];console.log("Prepared payload for second API call:",JSON.stringify(i));const r="https://saasimplementationserverdev.azurewebsites.net/plantAssignment/updateClassificationAttribute?id=".concat(a),c=await C("PATCH",r,i);return console.log("Second API call response:",JSON.stringify(c)),e}catch(i){return console.error("Error during classify or second API call:",i),[]}}}}}catch(i){return console.error("[updateClasses] Failed to process:",i),[]}};const C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("Fetching URL:",t),console.log("Method is:"),console.log("Request Body:",JSON.stringify(a,null,2));try{const o=await(0,f.A)({url:t,method:e,data:a});return console.log("Response received:",o.data),o}catch(o){throw console.error("Request failed:",o),o}},P="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",w=()=>{const{showErrorToast:e}=(0,c.A)(),t=(0,s.wA)();let a=window.widget.getValue("email");console.log("Email in usePlantAssignment:",a);return{handleCompanion:async(o,n,s,l)=>{try{t((0,m.Ve)(!0));const i=await(async()=>{try{let e=window.widget.getValue("Credentials");const t=await(0,g.fV)();console.log("Security Context is:",e);const a="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",o=await new Promise(((e,o)=>{t.authenticatedRequest(a,{method:"GET",type:"json",onComplete:e,onFailure:o})})),n=o.csrf.name,s=o.csrf.value,l="SecurityContext",i=e;return{[n]:s,[l]:i}}catch(e){return void console.error("[CSRF] Failed to fetch token:",e)}})();if(!i)return void e(d.rK);console.log("[UsePlantAssignment] Headers:",i);let r=[];if("Change Action"===l){const e=async()=>{const e=await h([o],i);return console.log("Parallel API response:",e),t((0,m.QL)(e)),e};let a=!1;console.log("The object Type is Change Action");const n=async e=>{const t="".concat(P,"/resources/v1/modeler/dslc/changeaction/").concat(s,"?%24fields=proposedChanges,realizedChanges"),o=await(0,g.ui)("GET",t,"",i);if(console.log("Response from Change Action URL:",o),o.status&&o.output){const t=o.output.realizedChanges.map((e=>e.where.identifier)),n=o.output.proposedChanges.map((async o=>{let n=o.where.identifier,s=o.where.type;if("Raw_Material"==s||"VPMReference"==s||"CreateAssembly"==s||"Provide"==s||"CreateMaterial"==s){if("NewVersion"===o.target){const e=await async function(e,t,a){const o="".concat(P,"/resources/v1/modeler/dslc/version/getGraph"),n="";try{const l="Raw_Material"===t?"/resources/v1/modeler/dsrm/dsrm:RawMaterial/".concat(e):"/resources/v1/modeler/dseng/dseng:EngItem/".concat(e),i={data:[{id:e,identifier:e,type:t,source:P,relativePath:l}]},r=await(0,g.ui)("POST",o,i,a);if(!r.status||!r.output)return console.error("API response does not contain the expected 'status' and 'output'."),n;{var s;const t=(null===(s=r.output.results[0])||void 0===s?void 0:s.versions)||[];for(const a of t)if(a.ancestors&&a.ancestors.some((t=>t.identifier===e)))return a.id}}catch(l){return console.error("Error fetching getLatestRevision for ".concat(e,":"),l),n}}(n,s,i);t.includes(e)&&(n=e)}if("Raw_Material"!==s&&"VPMReference"!==s){a=!0;const e=await async function(e,t){let a="";a="".concat(P,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(e,"/dsmfg:ScopeEngItem");try{const o=await(0,g.ui)("GET",a,"",t);return o.status&&o.output?{identifier:o.output.member[0].ScopeEngItem.identifier,type:o.output.member[0].ScopeEngItem.type}:(console.log("No valid response for identifier ".concat(e)),{})}catch(o){return console.error("Error fetching item details for ".concat(e,":"),o),{}}}(n,i);console.log("MFG Details are:",e),n=e.identifier,s=e.type}if(void 0!==n&&void 0!==s)try{var c,d,u,m;const t=await async function(e,t,a){let o="";o="Raw_Material"===t?"".concat(P,"/resources/v1/modeler/dsrm/dsrm:RawMaterial/").concat(e):"".concat(P,"/resources/v1/modeler/dseng/dseng:EngItem/").concat(e,"?mask=dsmveng:EngItemMask.Details");try{const t=await(0,g.ui)("GET",o,"",a);return t.status&&t.output?t.output:(console.log("No valid response for identifier ".concat(e)),{})}catch(n){return console.error("Error fetching item details for ".concat(e,":"),n),{}}}(n,s,i),a=(null===t||void 0===t||null===(c=t.member)||void 0===c||null===(d=c[0])||void 0===d||d.state,await async function(e,t,a,o,n){const s=[];let l=!1;const i="".concat(P,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(e,"?$mask=dslib:ClassificationAttributesMask");try{var r,c;const o=await(0,g.ui)("GET",i,"",t);console.log("Response for identifier ".concat(e,":"),o);let d=(null===(r=o.output.member[0])||void 0===r||null===(c=r.ClassificationAttributes)||void 0===c?void 0:c.member)||[];d=d.filter((e=>{const t=e.Attributes.find((e=>"PlantAssignmentClass"===e.name)),a=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)||!0===(null===a||void 0===a?void 0:a.value)})),0===d.length&&(d=await A(t,0,e,0,n)),l=d.some((e=>{const t=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)})),d.length>0?d.forEach((e=>{const t=e.ClassID;let o=null,n=null,l=!1,i="";var r;(e.Attributes.forEach((e=>{e.name.includes("PlantAssignmentClass")&&(l=e.value),e.name.includes("PlantStatus")&&(n=e.value),e.name.includes("FlowDownCA")&&(i=e.value)})),l)&&(o=null===(r=a.find((e=>e.id===t)))||void 0===r?void 0:r.title,o&&s.push({PlantName:o,PlantID:t,PlantERPStatus:n||"Pending",PlantFlowDownCA:i}))})):console.log("No valid classification data for identifier ".concat(e))}catch(d){console.error("Error fetching assigned classes for ".concat(e,":"),d)}return{ItemPlants:s,hasNoPlants:l}}(n,i,e,0,l)),o=a.ItemPlants,p=a.hasNoPlants;console.log("Item Plants are:",o),console.log("Has No Plants are:",p),console.log("ItemObjectdetails:",a),r.push({ItemId:n,ItemType:s,ItemState:(null===t||void 0===t?void 0:t.member[0].state)||"N/A",ItemTitle:(null===t||void 0===t?void 0:t.member[0].title)||"N/A",ItemMBOM:(null===t||void 0===t||null===(u=t.member[0])||void 0===u||null===(m=u["dseno:EnterpriseAttributes"])||void 0===m?void 0:m.EMR_hasMBOM)||"N/A",ItemPlants:o,hasNoPlants:p})}catch(p){console.error("Error processing change for item ".concat(n,":"),p)}}}));await Promise.all(n)}else console.error("Invalid response structure or no proposed changes.")},c=await e();await n(c),t((0,m.Ve)(!1)),t((0,m.OL)(r)),t((0,m.Dr)(a)),t((0,m.lT)(i))}else{const e=await(async(e,t,a)=>{try{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";console.log("[UserGroup Status] ProductId: ",t);const n=await(0,g.fV)();let s="".concat(o,"/resources/v1/modeler/dslc/sharing/getSharing");const l=await new Promise(((a,o)=>{n.authenticatedRequest(s,{method:"POST",headers:(0,p.A)((0,p.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify({data:[{objectID:t}]}),type:"json",onComplete:a,onFailure:o})}));console.log("[Assigned Plant Service] Data received:",l);let i=[],r={groups:[]};if(l&&(l.results.forEach((e=>{e.sharings.userGroups.forEach((e=>{"Can Edit"===e.access&&r.groups.push({uri:e.userGroupID.replace(/[<>]/g,"")})}))})),r.groups.length>0)){let e="https://oi000186152-us1-usersgroup.3dexperience.3ds.com/3drdfpersist/resources/v1/usersgroup/groups?select=uri,members,title";const t=await new Promise(((t,a)=>{n.authenticatedRequest(e,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(r),type:"json",onComplete:t,onFailure:a})}));console.log("Group Response is:",t),t&&(i=t.groups.filter((e=>e.members.includes(a))).map((e=>e.title)))}return console.log("[UserGroup Status] User Groups:",i),i}catch(o){throw console.error("[UserGroup Status] Error occurred:",o),o}})(i,s,a);console.log("[Plant Assignment] User Groups:",e);let r=[...e,o];console.log("[Use Plant Assignment] All CollabSpaces:",r);let c=[];if(r.length>0?(c=await h(r,i),console.log("[Use Plant Assignment] All Plants:",c)):console.warn("[Use Plant Assignment] No CollabSpaces found."),c.length>0){const e=await(async(e,t,a,o,n)=>{try{var s;const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";console.log("[Assigned Plant Service] Plant Members:",e);const l="".concat(o,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(a,"?$mask=dslib:ClassificationAttributesMask"),i=await(0,g.fV)(),r=await new Promise(((e,a)=>{i.authenticatedRequest(l,{method:"GET",headers:t,type:"json",onComplete:e,onFailure:a})}));console.log("[Assigned Plant Service] Data received:",r);let c=[],d=[],u=(null===(s=r.member[0].ClassificationAttributes)||void 0===s?void 0:s.member)||[];u=u.filter((e=>{const t=e.Attributes.find((e=>"PlantAssignmentClass"===e.name)),a=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)||!0===(null===a||void 0===a?void 0:a.value)}));const m=u.some((e=>{const t=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)}));return 0===u.length&&(u=await A(t,0,a,0,n)),await Promise.all(u.map((async a=>{console.log("Class Item is ",a);for(let o of e)if(a.ClassID===o.id){let e=o.title;e=e.replace("Plant","").replace(/\s+/g,"");let n={id:a.ClassID,title:o.title};const s=a.Attributes.map((a=>a.name.includes("FlowDownCA")&&a.value?v(a.value,t).then((e=>{if(e){console.log(e),n.MFGChange=null===e||void 0===e?void 0:e.MCOTitle,n.MFGStatus=null===e||void 0===e?void 0:e.MCOState;let t="",a="";e.CAAtt.forEach((e=>{t+=","+e.CATitle,a+=","+e.CAState})),n.Change=t.slice(1),n.ChangeStatus=a.slice(1)}})):(n[a.name.replace(e,"").trim()]=a.value,Promise.resolve())));await Promise.all(s),c=[...c,n],console.log("Initial Assigned Classes",c),console.log("Processed Object:",n)}}))),console.log("[Assigned Plant Service] Initial Assigned Classes:",c),d=e.filter((e=>!c.some((t=>t.id===e.id)))),console.log("uniqueInAllclasses--:",d),{success:!0,data:{plantData:{allPlants:e,initialAssignedPlants:c,uniquePlants:d,hasNoClass:m}}}}catch(l){return console.error("[Object Details] Failed to fetch data:",l),{success:!1,error:l}}})(c,i,s,0,l);console.log("[Use Plant Assignment]: ",e),e.success?(t((0,m.Lq)(e.data.plantData)),t((0,m.lL)(i))):console.error("Failed to fetch plant data.")}else console.warn("[Use Plant Assignment] No Plants found.");let d={};d="Raw_Material"===l?{success:!0,data:[]}:await(async(e,t)=>{const a="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let o="".concat(a,"/resources/v1/modeler/dseng/dseng:EngItem/");o+=t,o+="/expand";let n={expandDepth:1,type_filter_bo:["VPMReference"],type_filter_rel:["VPMInstance"]};try{console.log("[SearchCAService] ProductId is:",t);const s=await(0,g.fV)(),l=(t,a,o)=>new Promise(((n,l)=>{s.authenticatedRequest(t,{method:a,headers:(0,p.A)((0,p.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(o),type:"json",onComplete:e=>{console.log("Received response:",e),n(e)},onFailure:e=>{console.error("Request failed:",e),l(e)}})})),i=await l(o,"POST",n);console.log("[Get CA Details Service] Data received:",i);const{member:r}=i;if(r){let e=i.member.filter((e=>("VPMReference"===e.type||"Raw_Material"===e.type)&&e.id!==t)).map((e=>({id:e.id,type:e.type,name:e.title,state:e.state})));return e.length>0&&await Promise.all(e.map((async e=>{if("released"===e.state.toLowerCase()){let t="".concat(a,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(e.id,"?$mask=dslib:ClassificationAttributesMask");const o=await l(t,"GET","");console.log("classResponse->",o);const n=o.member.flatMap((e=>{var t;return null!==(t=e.ClassificationAttributes)&&void 0!==t&&t.member?e.ClassificationAttributes.member.map((e=>e.ClassID)):[]}));e.classes=n}}))),{success:!0,data:e}}}catch(s){return console.error("Error while Fetching",s),{success:!1,data:[],error:s}}})(i,s),console.log("Type After:",l),console.log("[Use Plant Assignment] Product Children:",d),d.success&&t((0,m.VG)(d.data));const u=await(async(e,t,a)=>{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let n=!1,s=[],l={CAName:"",CAStatus:""};const i=["caproposedwhere_from","carealizedwhere_from"],r="".concat(o,"/resources/enorelnav/v2/navigate/setPreferences");let c={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",relations:["caproposedwhere_from","carealizedwhere_from"],allRelationsMode:!1,publicationsMode:!1,computeWithInstances:!1,attributesForView:["ds6w:status","ds6w:type","ds6w:identifier","ds6w:label"],label:"ENXENG_AP-e1331143-1734517777960",lang:"en",ghostMode:!1},d="".concat(o,"/resources/enorelnav/v2/navigate/getEcosystem"),u={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",responseMode:"objectsByPatterns",label:"ENXENG_AP-e1331143-1734517780491",ids:[t]};try{console.log("[Get CA Details] Product ID:",t);const m=await(0,g.fV)(),h=await new Promise(((t,a)=>{m.authenticatedRequest(r,{method:"POST",headers:(0,p.A)((0,p.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(c),type:"json",onComplete:t,onFailure:a})}));if(console.log("[Get CA Details Service] Data received:",h),"OK"===h.status){const r=await new Promise(((t,a)=>{m.authenticatedRequest(d,{method:"POST",headers:(0,p.A)((0,p.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(u),type:"json",onComplete:t,onFailure:a})}));console.log("[Get CA Details Service] Data received:",r);for(const c of i)r.objectsByPatterns[c]&&await Promise.all(r.objectsByPatterns[c].map((async i=>{const r=i["ds6w:status"].slice(14),d=i["ds6w:label"];if("Complete"!==r){const u="".concat(o,"/resources/v1/modeler/dslc/changeaction/").concat(i.id,"?$fields=proposedChanges,realizedChanges,flowDown"),p=await new Promise(((t,a)=>{m.authenticatedRequest(u,{method:"GET",headers:e,type:"json",onComplete:t,onFailure:a})}));console.log("response3 Data will appear:",p),"caproposedwhere_from"===c?Array.isArray(p.proposedChanges)&&p.proposedChanges.forEach((e=>{s.push({identifier:e.where.identifier,action:e.whats[0].what})})):Array.isArray(p.realizedChanges)&&p.realizedChanges.forEach((e=>{s.push({identifier:e.where.identifier,action:e.operations[0]})})),n="released"!==a.toLowerCase()||s.some((e=>e.identifier===t&&"Modify"===e.action)),n&&(l.CAName=d,l.CAStatus=r)}})))}else console.error("Unable to Fetch the ");return console.log("Status is coming inside 7"),console.log("Response Object is:",n),{success:!0,data:n,CAData:l,proposedChanges:s}}catch(m){throw console.error("Failed Request:",{url:r,headers:e,body:c,error:m}),m}})(i,s,n);console.log("[Use Plant Assignment] CA Details:",u),u.success&&(t((0,m.ug)(u.data)),t((0,m.aB)(u.proposedChanges)),t((0,m.hF)(u.CAData))),console.log("[Plant Assignment] All services executed successfully.")}}catch(i){console.error("[Plant Assignment] Error:",i),e("An error occurred while fetching plant assignment data.")}finally{t((0,m.Ve)(!1))}}}};var b=a(314);const I=()=>{const{showErrorToast:e}=(0,c.A)(),{handleCompanion:t}=w(),a=(0,s.d4)((e=>e.droppedObject.isDropped)),n=(0,s.d4)((e=>e.droppedObject.loading)),l=(0,s.wA)(),i=(0,o.useCallback)((async a=>{try{const s=await(0,b.Sj)({dataItems:a});if(s.success){l((0,m.um)({cardData:s.data.cardData}));const e=s.data.cardData;var o,n;if(console.log("[Dragged Items are]",e),l((0,m.Rr)(!0)),s)await t(e["Collaborative Space"],e["Maturity State"],null===(o=a[0])||void 0===o?void 0:o.objectId,null===(n=a[0])||void 0===n?void 0:n.objectType)}else e(d.wX)}catch(s){console.error("[FetchObjectDetails] Error fetching details:",s),e(d.wX)}finally{l((0,m.r1)(!1))}}),[l,t]),r=(0,o.useCallback)((async t=>{console.log("[handleDrop] handleDrop called with dataItems:",t);try{if(t&&t.length>0){var a;const o=null===(a=t[0])||void 0===a?void 0:a.objectType;if(!["VPMReference","Raw_Material","Change Action","CreateKit","CreateAssembly","CreateMaterial","Provide","ProcessContinuousProvide"].includes(o))return void e(d.Zo);l((0,m.Rr)(!0)),console.log("[handleDrop] \ud83d\udd04 Force setting `loading = true`..."),l((0,m.r1)(!1)),setTimeout((()=>l((0,m.r1)(!0))),0),await i(t)}else console.warn("[handleDrop] No data items to process.")}catch(o){console.error("[Drop] Error in handleDrop:",o),l((0,m.r1)(!1)),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(d.nz)}}),[i,e]);return{initializeDroppableArea:(0,o.useCallback)((()=>{a?console.log("[initializeDroppableArea] \u23f3 isDropped is already true. Skipping reset."):(console.log("[initializeDroppableArea] \ud83d\ude80 Resetting isDropped to false..."),l((0,m.Rr)(!1)));const t=setInterval((()=>{const a=document.querySelector(".droppable-container");a&&(clearInterval(t),(0,b.pn)(a,r,l,e))}),100);return()=>clearInterval(t)}),[r,l]),loading:n,handleDrop:r}};var y=a(579);const S=()=>{const{handleDrop:e}=I(),{showSuccessToast:t,showErrorToast:a}=(0,c.A)(),[n,s]=(0,o.useState)(!1);console.log("---[WidgetLifecycle]--- starts");return(0,o.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var o,n;const i=(new Error).stack.split("\n"),c=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(i)&&!c)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),s(!0);const u=l.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===u||void 0===u||null===(o=u.data)||void 0===o||null===(n=o.items)||void 0===n||!n.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",u),void s(!1);try{await(0,r.M)(u.data.items,e)}catch(m){console.error("[WidgetLifecycle] \u274c Error during refresh:",m),a(d.H6)}finally{s(!1),t(d._l)}}))}),[]),n?(0,y.jsx)(u.A,{}):null};var D=a(45),M=(a(4816),a(3637)),j=a(768),N=a(759),R=a(6878),O=a(184),E=a(3825);const T=e=>{let{plants:t=[],itemId:a,isRemoveMode:o,handleRemovePlant:n,isMFGCA:s}=e;return console.log("PlantRenderer received plants:",t),null!==t&&void 0!==t&&t.length?(0,y.jsx)(y.Fragment,{children:t.map((e=>(0,y.jsxs)("span",{style:{marginRight:"8px",display:"inline-flex",alignItems:"center",color:e.color||"black",fontWeight:"bold"},children:[e.PlantName,"green"===e.color&&" - Add","red"===e.color&&(s?" - Updated":" - Removed"),o&&"Pending"===e.PlantERPStatus&&(0,y.jsx)(E.zhF,{size:16,style:{cursor:"pointer",color:"red",marginLeft:"4px"},onClick:()=>n(a,e.PlantID)})]},e.PlantID)))}):"N/A"},x=(e,t,a)=>{if(console.log("cadata datahelpers",a),!e)return[];let o=e.map((e=>"Change Action"===t?{ItemName:(null===e||void 0===e?void 0:e.ItemTitle)||"N/A",Plant:(null===e||void 0===e?void 0:e.ItemPlants)||[],ItemId:(null===e||void 0===e?void 0:e.ItemId)||"N/A"}:(console.log("change data datahelper",(null===e||void 0===e?void 0:e.Change)||a.CAName||"N/A"),{Plant:(null===e||void 0===e?void 0:e.title)||"N/A",Seq:(null===e||void 0===e?void 0:e.Seq)||"1",Status:(null===e||void 0===e?void 0:e.PlantStatus)||"Pending","MFG Change":(null===e||void 0===e?void 0:e.MFGChange)||"N/A","MFG Status":(null===e||void 0===e?void 0:e.MFGStatus)||"N/A",Change:(null===e||void 0===e?void 0:e.Change)||a.CAName||"N/A","Change Status":(null===e||void 0===e?void 0:e.ChangeStatus)||a.CAStatus||"N/A","Oracle Template":e.OracleTemplate||"N/A","ERP Status":"Active","ERP Export":"Yes","Lead Plant":!1,MBom:e.MBOM?"Make":"Buy","Sort Value":""})));return"Change Action"===t?o.sort(((e,t)=>e.ItemName.localeCompare(t.ItemName))):o.sort(((e,t)=>e.Plant.localeCompare(t.Plant))),o},F=[{accessorKey:"Available Plant",header:"Available Plant"}];var k=a(3127),B=a(5362),_=a(6313);a(3728);const G=e=>{let{onAddPlant:t,addedPlant:a,onSave:n,onRemove:s,uniquedata:l,uniqueColumn:i,CAName:r,state:u,type:m,isMFGCA:p,CAData:g,hasChanges:h,onCancel:v,setHasChanges:f}=e;const{showWarningToast:A,showSuccessToast:C}=(0,c.A)(),P=e=>"Approved"===e||"In Approval"===e||"Completed"===e,[w,b]=(0,o.useState)(!1),I=(0,o.useRef)();console.log("[Unique Table Data]:",l);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"d-flex cta-absolute",children:[!p&&(0,y.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{P(u)?A(d.rz):"Change Action"===m||r?b(!0):A("RELEASED"===u?d.sL:d.Ru)},children:"Add Plant"}),p&&(0,y.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{"Approved"===u||"In Approval"===u||"Completed"===u?A(d.rz):b(!0)},children:"Add/Update Plants"}),"Change Action"===m&&(0,y.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{P(u)?A(d.rz):n&&("Change Action"===m||r)?n():A("RELEASED"===u?d.EZ:d.nX)},children:"Save"}),!1===p&&(0,y.jsx)("button",{className:"btn btn-outline-danger btn-lg m-2",onClick:()=>{P(u)?A(d.rz):s&&s()},children:"Remove"}),h&&(0,y.jsx)("button",{className:"btn btn-outline-secondary btn-lg m-2",onClick:v,children:"Cancel"})]}),(0,y.jsx)(_.A,{show:w,onHide:()=>b(!1),title:"Available Plant",footerButtons:[{label:"Add",variant:"primary",onClick:()=>{var e;null===(e=I.current)||void 0===e||e.addPlant(),b(!1)}},{label:"Close",variant:"danger",onClick:()=>b(!1)}],children:(0,y.jsx)("div",{className:"modal-body",children:(0,y.jsx)(B.A,{ref:I,data:l,columns:i,CAName:r,addedItem:e=>{if(console.log(e),"Change Action"===m)e.length>0&&(t(e),a(e),f&&f(!0));else if(e.length>0){const o=e.map((e=>({title:e,Seq:"1",Status:"Pending","MFG Change":"N/A","MFG Status":"N/A",Change:g.CAName,"Change Status":g.CAStatus,"Oracle Template":"N/A","ERP Status":"Active","ERP Export":"Yes","Lead Plant":"false",MBom:"N/A","Sort Value":""})));t(o),a(e),f&&f(!0)}},state:u})})})]})};a(4119);var q=a(1397),L=a(4675);a(3910);const V=e=>{let{handleFileInputChange:t,fileInputRef:a,isFileInputDisabled:o,handleSubmit:n,isCreateButtonDisabled:s,handleReset:l}=e;const{handleDrop:i}=I(),{performSearch:r}=(0,L.A)();return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)("div",{className:"droppable-container mt-4",children:[(0,y.jsx)(M.A,{style:{width:"90px",height:"65px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,y.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop"}),(0,y.jsxs)("div",{className:"divider-container",children:[(0,y.jsx)("hr",{className:"divider"}),(0,y.jsx)("span",{className:"divider-text",children:"or"}),(0,y.jsx)("hr",{className:"divider"})]}),(0,y.jsx)(q.A,{onSearch:e=>{r(e,{title:"Search",role:"",mode:"furtive",default_with_precond:!0,precond:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/Raw_Material" OR flattenedtaxonomies:"types/Document"',show_precond:!1,multiSel:!1,idcard_activated:!1,select_result_max_idcard:!1,itemViewClickHandler:"",search_delegation:"3dsearch"},(e=>{console.log("Selected objects:",e),console.log("objectId: selectedObjects[0].id",e[0].id),e&&e.length>0&&e[0].id?i([{objectId:e[0].id,objectType:e[0]["ds6w:type_value"]}]):console.warn("No objectId found in selected objects")}))}})]})})};var z=a(3353),U=(a(9332),a(6292)),K=a(2268),H=a(5658);const W=["title"],J=["color"],$=()=>{const{showSuccessToastWithProgress:e,showErrorToastWithProgress:t}=(0,c._)(),[a,n]=(0,o.useState)(!1),[i,g]=(0,o.useState)(!1),[h,v]=(0,o.useState)(!1),[f,A]=(0,o.useState)(null),[C,P]=(0,o.useState)(!1),[w,b]=(0,o.useState)([]),{initializeDroppableArea:S,loading:E}=I(),[B,_]=(0,o.useState)(0),[q,L]=(0,o.useState)([]),[J,$]=(0,o.useState)([]),[Z,Q]=(0,o.useState)(null),[ee,te]=(0,o.useState)([]),[ae,oe]=(0,o.useState)([]),[ne,se]=(0,o.useState)(!1),[le,ie]=(0,o.useState)(!0),{handleDrop:re}=I(),[ce,de]=(0,o.useState)(!1),[ue,me]=(0,o.useState)(!1),[pe,ge]=(0,o.useState)(!1),[he,ve]=(0,o.useState)(!1),fe=(0,s.wA)(),{showSuccessToast:Ae,showErrorToast:Ce}=(0,c.A)(),[Pe,we]=(0,o.useState)([]),[be,Ie]=(0,o.useState)(!1);let ye=window.widget.getValue("Credentials");console.log("Security context is: ",ye);const Se=(0,o.useRef)(null),De=(0,o.useCallback)(((e,t)=>{oe((a=>a.map((a=>a.ItemId===e?(0,p.A)((0,p.A)({},a),{},{ItemPlants:a.ItemPlants.map((e=>e.PlantID===t?(0,p.A)((0,p.A)({},e),{},{color:"red"===e.color?"green":"red"}):e))}):a)))),Ie(!0)}),[oe]),Me=e=>{const t=e.map((e=>({itemName:e.ItemName,plantName:e.Plant})));return console.log("Extracted Plant Data:",t),t};console.log("Table Data after Adding:",q);const je=(0,s.d4)((e=>e.droppedObject.selectedTableRows));(0,o.useEffect)((()=>{je.length>0&&Ie(!0)}),[je]);const Ne=(0,s.d4)((e=>e.droppedObject.droppedObjectData));console.log("droppedObjectData",Ne);const Re=(0,s.d4)((e=>e.droppedObject.CAItemObjectDetails.CAItemDetails));console.log("The CA Item Details are:",Re);const Oe=(0,s.d4)((e=>e.droppedObject.CAItemObjectDetails.CAallPlants));console.log("For CA all Plants are: ",Oe);const Ee=(0,s.d4)((e=>e.droppedObject.CAItemObjectDetails.CAheaders));console.log("caheaders plant assign",Ee);const Te=(0,s.d4)((e=>e.droppedObject.CAItemObjectDetails.CAisMFGCA));console.log("isMFGCA value is:",Te);const xe=(0,s.d4)((e=>e.droppedObject.loadingParentDetails));console.log("Parents Loading State:",xe);const Fe=(0,s.d4)((e=>e.droppedObject.plantObjectData.proposedChanges));console.log("Proposed Changes are:",Fe);const ke=(0,s.d4)((e=>e.droppedObject.isDropped)),Be=(0,s.d4)((e=>e.droppedObject.plantObjectData.allPlants));console.log("[PlantAssignment] plant object data: ",Be);const _e=(0,s.d4)((e=>e.droppedObject.plantObjectData.uniquePlants));console.log("[Plant Assignment] Unique Plants:",_e);const Ge=(0,s.d4)((e=>e.droppedObject.plantObjectData.initialAssignedPlants));console.log("The Assigned Plants are:",Ge);const qe=(0,s.d4)((e=>e.droppedObject.plantObjectData.hasNoClass));console.log("The HasNoClass is:",qe);const Le=(0,s.d4)((e=>e.droppedObject.plantObjectData.CAData));console.log("The CAData is....:",Le);const Ve=(0,s.d4)((e=>e.droppedObject.plantObjectData.productChildren));console.log("[Plant Assignment] Product Children:",Ve);const ze=(0,s.d4)((e=>e.droppedObject.plantObjectData.CAName));console.log("[plant Assignment] CAName:",ze);const Ue=(0,s.d4)((e=>e.droppedObject.plantObjectData.headers));console.log("[Plant Assignment] Headers are: ",Ue);const Ke=(0,o.useCallback)((()=>{let e=Oe.map((e=>e.title.replace(/^Plant /,"")));const t=0===je.length?q:je;let a=[...new Set(t.flatMap((e=>{var t;return(null===(t=e.Plant)||void 0===t?void 0:t.map((e=>e.PlantName)))||[]})))],o=e.filter((e=>!a.includes(e))).map((e=>({title:e})));return console.log("Unique table plants are :",o),e.map((e=>({title:e})))}),[Oe,q,je,Te]),He=e=>{L(e)};if(console.log("Tanble Data is:",q),(0,o.useEffect)((()=>{q.length>=0&&_((e=>e+1))}),[q]),Ne.cardData&&Ne.initialDraggedData)var We,Je,$e=Ne.cardData["Maturity State"],Xe=Ne.cardData.HasMBOM,Ye=null===(We=Ne.initialDraggedData)||void 0===We||null===(Je=We.data)||void 0===Je?void 0:Je.items[0].objectType;const[Ze,Qe]=(0,o.useState)(Ge);console.log("Duplicate Initial Assigned Classes are:",Ze),(0,o.useEffect)((()=>{Qe(Ge),"Change Action"===Ye?oe(Re):$(Ge)}),[Ge,Ye,Re]),(0,o.useEffect)((()=>{"Change Action"===Ye&&te(Ke())}),[Ke,Ye]),(0,o.useEffect)((()=>{"Change Action"!==Ye&&te(_e)}),[_e,Ye]);const et=async e=>{var t,a;let o={};const n=[];console.log("Table Data",e),console.log("Before DupInitialAssignedClasses:",Ze);let s=[],l=Ze.map((t=>{let a=(0,p.A)({},t);return e.forEach((e=>{var t;let n={};const l=e.Plant.replace("Plant","").replace(/\s+/g,""),i=null===(t=Be.find((t=>t.title===e.Plant)))||void 0===t?void 0:t.id;if(a.title===e.Plant){(a.MBOM?"Make":"Buy")!==e.MBom&&(/^\d/.test(l)?(o["MBOM".concat(l)]="Make"===e.MBom,n.MBOMName="MBOM".concat(l),n.MBOMValue="Make"===e.MBom):(o["".concat(l,"MBOM")]="Make"===e.MBom,n.MBOMName="".concat(l,"MBOM"),n.MBOMValue="Make"===e.MBom),a.MBOM="Make"===e.MBom,n=(0,p.A)((0,p.A)({},n),{},{id:i,title:e.Plant,Type:"Update"}),s.push(n))}})),a}));e.forEach((e=>{if(!Ze.find((t=>t.title===e.Plant))){var t;const a=e.Plant.replace("Plant","").replace(/\s+/g,""),i=null===(t=Be.find((t=>t.title===e.Plant)))||void 0===t?void 0:t.id;if(i){let t={id:i,title:e.Plant},r={};n.push(i),"Make"===e.MBom?(/^\d/.test(a)?(o["MBOM".concat(a)]=!0,r.MBOMName="MBOM".concat(a)):(o["".concat(a,"MBOM")]=!0,r.MBOMName="".concat(a,"MBOM")),t.MBOM=!0,r.MBOMValue=!0):(t.MBOM=!1,r.MBOMValue=!1),l.push(t),r=(0,p.A)((0,p.A)({},r),{},{id:i,title:e.Plant,Type:"New"}),s.push(r)}}}));let i=[];Ze.forEach((t=>{if(!e.some((e=>e.Plant===t.title))){var a;const e=null===(a=Be.find((e=>e.title===t.title)))||void 0===a?void 0:a.id;e&&i.push(e)}})),l=l.filter((e=>!i.includes(e.id))),console.log("Rows getting deleted rowstoDelete:",i),console.log("After DupInitialAssignedClasses:",l),console.log("Classes to be Classified:",n),console.log("Updated Items:",o),console.log();const r=await(0,k.iu)(o,n,l,Ue,null===(t=Ne.initialDraggedData)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.items[0].objectId,Be,Ve,Ye,i,s,Fe);if(r.success){me(!1),console.log("Save result:",r),""===r.Finalmessage||null==r.Finalmessage?Ae(d.KF):Ce((e=>{if(!e)return"An error occurred.";const t=e.split("\n").filter((e=>""!==e.trim()));return(0,y.jsxs)("div",{style:{userSelect:"text",cursor:"text",position:"relative",paddingRight:"40px"},children:[(0,y.jsx)("strong",{children:"Errors:"}),(0,y.jsx)("button",{onClick:()=>{const e=t.map((e=>"- ".concat(e))).join("\n");navigator.clipboard.writeText(e)},style:{position:"absolute",right:"10px",top:"-12px",background:"none",border:"none",cursor:"pointer",fontSize:"16px",color:"grey"},children:(0,y.jsx)(O.zU_,{size:12})}),(0,y.jsx)("ol",{children:t.map(((e,t)=>(0,y.jsx)("li",{children:e},t)))})]})})(r.Finalmessage),{autoClose:!1});let e=[];if(r.ErrorObj&&Object.keys(r.ErrorObj).length>0){let t=function(e,t,a,o){return console.log("Assigned Plants are:",t),console.log("unique Plants are:",o),e.forEach((e=>{"New"===e.type?(a=a.filter((t=>t.title!==e.title)),o.some((t=>t.title===e.title))||o.push(e)):"Update"===e.type&&(a=a.map((t=>t.title===e.title?(0,p.A)((0,p.A)({},t),{},{MBOM:"false"}):t)))})),{updatedAssignedClasses:a,uniquePlant:o}}(r.ErrorObj,J,l,_e);console.log("response is ",t),t&&(te(t.uniquePlant),e=t.updatedAssignedClasses)}else e=l;e&&($(e),Qe(e)),oe((e=>e.map((e=>(0,p.A)((0,p.A)({},e),{},{ItemPlants:e.ItemPlants.map((e=>(0,p.A)((0,p.A)({},e),{},{color:void 0})))})))))}else me(!1),Ce(d.fm)};(0,o.useEffect)((()=>{ke||S()}),[ke,S]),(0,o.useEffect)((()=>{de(xe)}),[xe]);const tt=(0,o.useMemo)((()=>x("Change Action"===Ye?ae:J,Ye,Le)),[ae,J,Ye,Le]),at=(0,o.useMemo)((()=>(e=>e?e.map((e=>({"Available Plant":(null===e||void 0===e?void 0:e.title)||"N/A"}))):[])(ee)),[ee]);console.log("[Plant Assignment] Unique Table Data:",at);const ot=(0,o.useMemo)((()=>(e=>{if(!e||!e.cardData)return null;const t=e.cardData;let a={title:t.Title||"N/A",type:t.Type||"N/A","Maturity State":t["Maturity State"]||"N/A",owner:t.Owner||"N/A","Collaborative Space Title":t["Collaborative Space Title"]||"N/A",Description:t.Description||"N/A","Dropped Revision":t["Dropped Revision"]||"N/A","Latest Released Revision":t["Latest Released Revision"]||"N/A","CAD Format":t["CAD Format"]||"N/A",imageURL:t.imageURL||"".concat("https://oi000186152-us1-space.3dexperience.3ds.com/enovia","/snresources/images/icons/large/I_VPMNavProduct108x144.png")};return"Document"!==t.Type&&(a.EIN=t.EIN||"N/A",a["CAD Format"]=t["CAD Format"]||"N/A"),a})(Ne)),[Ne]);console.log(ot),(0,o.useEffect)((()=>{"Change Action"===Ye&&Te&&ve(!1)}),[ot,q,Te,Ye]),(0,o.useEffect)((()=>{tt.length>=0&&(console.log("New Table Data:",tt),L(tt),we(JSON.parse(JSON.stringify(tt))),_((e=>e+1)))}),[tt]),(0,o.useEffect)((()=>{ge(!!ot)}),[ot]);const nt=(0,o.useMemo)((()=>((e,t,a,o,n)=>(console.log("type here is: ",t),"Change Action"===t?[{accessorKey:"ItemName",header:"Item Name"},{accessorKey:"Plant",header:"Plant",cell:e=>{let{row:t}=e;const s=t.original.Plant,l=Array.isArray(s)?s.map((e=>e.PlantName||e.title||"")).join(", "):"N/A";return(0,y.jsx)("span",{title:l,children:(0,y.jsx)(T,{plants:s,itemId:t.original.ItemId,isRemoveMode:a,handleRemovePlant:o,isMFGCA:n})})}}]:[{accessorKey:"Plant",header:"Plant"},{accessorKey:"Seq",header:"Seq"},{accessorKey:"Status",header:"Status"},{accessorKey:"Change",header:"Change"},{accessorKey:"Change Status",header:"Change Status"},{accessorKey:"MFG Change",header:"MFG Change"},{accessorKey:"MFG Status",header:"MFG Status"},{accessorKey:"Oracle Template",header:"Oracle"},{accessorKey:"MBom",header:"MBom"},{accessorKey:"ERP Status",header:"ERP Status"},{accessorKey:"ERP Export",header:"ERP Export"},{accessorKey:"Lead Plant",header:"Lead Plant"},{accessorKey:"Sort Value",header:"Sort Value"}]))(0,Ye,he,De,Te)),[ze,Ye,he,De,Te]),st=(0,o.useMemo)((()=>F),[]);(0,o.useEffect)((()=>{console.log("[PlantAssignment] State Changes:",{loading:E,loadingParentDetails:xe,isDropped:ke})}),[E,xe,ke]);return console.log("Has Changes?",be),(0,y.jsxs)(y.Fragment,{children:[ue&&(0,y.jsx)(u.A,{}),(0,y.jsx)(R.A,{show:a,onHide:()=>n(!1),onConfirm:async()=>{n(!1),await(async()=>{var t,a;const o=await(0,K.I)(),n=(0,p.A)({"Content-Type":"application/json"},o);console.log("Confirmed remove logic running...");const s=je.map((e=>e.Plant)),i=s.map((e=>({title:e}))),r=q.filter((e=>!s.includes(e.Plant)));r&&(L(r),_((e=>e+1))),te((e=>[...e,...i])),e("Plants removed successfully.");const c=0===r.length;if(console.log("allPlantsRemoved",c),console.log("hasNoClassData",qe),c&&!qe){var d,u;await(0,U.m)(n,Ye,null===(d=Ne.initialDraggedData)||void 0===d||null===(u=d.data)||void 0===u?void 0:u.items[0].objectId),fe((0,m.Lq)((0,p.A)((0,p.A)({},l.A.getState().droppedObject.plantObjectData),{},{hasNoClass:!0})))}await(0,k.Bx)(Be,i,null===(t=Ne.initialDraggedData)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.items[0].objectId,Ye)})()}}),!ke&&!E&&!ce&&(0,y.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:(0,y.jsx)(V,{handleFileInputChange:e=>{(0,H.fp)(e,b,P,Ce,Ae,A,Q,ie,se).finally((()=>{me(!1)}))},fileInputRef:Se,isFileInputDisabled:ne,handleSubmit:async()=>{if(f){me(!0);try{await(0,H.uk)(f,e,t)}catch(a){console.error("Error in handleSubmit:",a)}finally{me(!1)}ie(!0)}else Ce("Please upload and validate a file before proceeding.")},isCreateButtonDisabled:le,handleReset:()=>{A(null),Q(null),b([]),P(!1),L([]),te([]),oe([]),$([]),Qe([]),_(0),se(!1),Se.current&&(Se.current.value=""),ie(!0)}})}),ke&&(0,y.jsxs)(y.Fragment,{children:[E&&(0,y.jsx)(u.A,{}),(0,y.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,y.jsxs)("div",{className:"d-flex ",children:[(0,y.jsx)("div",{className:" p-0 pt-4",children:(0,y.jsx)(M.A,{src:"https://thewhitechamaleon.github.io/testrapp/images/home.png",alt:"home-icon",className:"home-icon",onClick:()=>{S(),fe((0,m.Rr)(!1)),fe((0,m.um)({cardData:{},parentDetails:[],versions:[],initialDraggedData:[]})),fe((0,m.Lq)({allPlants:[],initialAssignedPlants:[],uniquePlants:[],productChildren:[],CAName:!1,headers:{},proposedChanges:[],CAData:{}})),fe((0,m.XC)({CAItemDetails:[],CAallPlants:[],CAisMFGCA:!1,CAheaders:{}})),L([]),ge(!1)}})}),ot&&(0,y.jsx)(N.A,{data:ot,widgetType:"PlantAssignment"})]})}),ce?(0,y.jsx)("div",{className:"loading-indicator mt-5",children:(0,y.jsx)(u.A,{})}):(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)("div",{className:"wrapper-cta",children:[(0,y.jsx)(G,{uniquedata:at,uniqueColumn:st,CAName:ze,onAddPlant:async a=>{if(v(!0),console.log("Data Received",a),console.log("[Plant Assignment] Table data",q),console.log("Added Data from Toolbar",a),console.log("CA Table data is",Re),_((e=>e+1)),"Change Action"===Ye)console.log("Change Action Plant is Added"),oe((e=>e.map((e=>{if(!(0===je.length||je.some((t=>t.ItemId===e.ItemId))))return e;const t=Re.find((t=>t.ItemId===e.ItemId)),o=(null===t||void 0===t?void 0:t.ItemPlants)||[],n=e.ItemPlants||[],s=n.map((e=>Te&&a.includes(e.PlantName.trim())&&o.some((t=>t.PlantName.trim()===e.PlantName.trim()))?(0,p.A)((0,p.A)({},e),{},{color:"red"}):e)),l=[];return a.forEach((e=>{const t=Oe.find((t=>t.title.replace(/^Plant\s+/,"").trim()===e.trim()));if(!t)return;const a=o.some((t=>t.PlantName.trim()===e.trim()));n.some((t=>t.PlantName.trim()===e.trim()))||l.push((0,p.A)({PlantName:e,PlantID:t.id,PlantERPStatus:"Pending"},a?{color:"red"}:{color:"green"}))})),(0,p.A)((0,p.A)({},e),{},{ItemPlants:[...s,...l]})}))));else{me(!0),console.log("Handling plants for table addition...");try{var o,n;const{ErrorObject:s,Finalmessage:l}=await(0,k.Eo)(a,Be,null===(o=Ne.initialDraggedData)||void 0===o||null===(n=o.data)||void 0===n?void 0:n.items[0].objectId,Ye,Fe,Ve,Xe);console.log("ErrorObject from handleAddData:",s),console.log("Finalmessage from handleAddData:",l);const i=s.map((e=>{var t;return null===(t=Be.find((t=>t.id===e.ClassID)))||void 0===t?void 0:t.title}));console.log("Errored Plants:",i);const r=a.filter((e=>!i.includes(e.title))),c=a.filter((e=>i.includes(e.title)));console.log("Valid Plants:",r),console.log("Invalid Plants:",c),c.length>0&&(l&&t(l,{}),console.log("Finalmessage displayed in toast:",l)),te((e=>[...e,...c.map((e=>({title:e.title})))])),r.length>0&&(L((e=>[...r.map((e=>{let{title:t}=e,a=(0,D.A)(e,W);return(0,p.A)({Plant:t},a)})),...e])),_((e=>e+1)),e("Plants added successfully."),Ie(!0))}catch(s){console.error("Error while adding plants:",s),t("Failed to add plants. Please try again.")}finally{me(!1)}}},addedPlant:e=>{console.log("The data received from Child is:",e);const t=at.filter((t=>!e.find((e=>e===t["Available Plant"]))));if(console.log("Updated Table Data after unique:",t),t){const e=t.map((e=>({title:e["Available Plant"]})));console.log(e),te(e)}},onSave:async()=>{if(console.log("OnSave is Called with the TableData",q),Me(q),me(!0),"Change Action"===Ye)if(!0===Te){console.log("Manufacturing CA Save Called");const e=await X(q,Ne,Re);if(console.log("response from Save Api is :",e),e){const e=q.map((e=>{const t=Re.find((t=>t.ItemId===e.ItemId));return{ItemId:e.ItemId,ItemType:null===t||void 0===t?void 0:t.ItemType,ItemState:null===t||void 0===t?void 0:t.ItemState,ItemTitle:e.ItemName,ItemPlants:e.Plant.map((e=>{let{PlantName:t,PlantID:a}=e;return{PlantName:t,PlantID:a}}))}}));fe((0,m.OL)(e)),me(!1)}else console.warn("Save API returned false"),me(!1)}else{console.log("Engineering CA Save Called");const a=await Y(q,Ne,Re);if(console.log("response from Save Api is :",a),a){var e,t;const a=q.map((e=>{const t=Re.find((t=>t.ItemId===e.ItemId));return{ItemId:e.ItemId,ItemType:null===t||void 0===t?void 0:t.ItemType,ItemState:null===t||void 0===t?void 0:t.ItemState,ItemTitle:e.ItemName,ItemPlants:e.Plant.map((e=>{let{PlantName:t,PlantID:a}=e;return{PlantName:t,PlantID:a}}))}}));fe((0,m.OL)(a));const o=null===(e=l.A.getState().droppedObject.droppedObjectData.initialDraggedData)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.items;null!==o&&void 0!==o&&o.length&&await(0,r.M)(o,re),me(!1)}else console.warn("Save API returned false"),me(!1)}else await et(q)},onRemove:async()=>{if(console.log("Type value is:",Ye),console.log("shouldTriggerRemove is:",i),"Change Action"===Ye)return console.log("Remove is clicked for Chnage Action"),void ve((e=>!e));if(["Raw_Material","VPMReference"].includes(Ye)&&!i)return je&&0!==je.length?void n(!0):void t("Please select at least one row to remove.");if(je.length>0){var a,o;console.log("Selected Table Rows:",je),console.log("handleRemove is Called with the TableData",q);const t=je.map((e=>e.Plant));console.log("Selected Titles:",t);const n=t.map((e=>({title:e})));console.log("Removed Titles:",n);const s=q.filter((e=>!t.includes(e.Plant)));console.log("updateTableData",He),He&&(L(s),Ie(!0),_((e=>e+1))),te((e=>[...e,...n])),e("Plants removed successfully."),await(0,k.Bx)(Be,n,null===(a=Ne.initialDraggedData)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.items[0].objectId,Ye)}},state:$e,type:Ye,isMFGCA:Te,CAData:Le,hasChanges:be,onCancel:()=>{L(JSON.parse(JSON.stringify(Pe))),L(Pe),Ie(!1),oe(Re),ve(!1),"Change Action"===Ye&&oe((e=>e.map((e=>(0,p.A)((0,p.A)({},e),{},{ItemPlants:e.ItemPlants.map((e=>(0,p.A)((0,p.A)({},e),{},{color:void 0})))})))))},setHasChanges:Ie}),(0,y.jsx)(j.A,{data:q,columns:nt,widgetType:"Plant_Assignment_Widget"},B)]})})]}),(0,y.jsx)(z.A,{show:C,onHide:()=>P(!1),errors:w})]})},X=async(e,t,a)=>{var o,n,s;const l=(null===(o=t.initialDraggedData)||void 0===o||null===(n=o.data)||void 0===n||null===(s=n.items)||void 0===s?void 0:s[0])||{},i=t.cardData||{},r={CATitle:i.Title,CAId:l.objectId,CAOrganization:i.organization,CACollabSpace:i["Collaborative Space"],CAOwner:"e1331143",Items:e.map((e=>{const t=a.find((t=>t.ItemId===e.ItemId));return{ItemId:e.ItemId,ItemType:(null===t||void 0===t?void 0:t.ItemType)||"VPMReference",ItemState:(null===t||void 0===t?void 0:t.ItemState)||"IN_WORK",ItemTitle:e.ItemName,ItemPlants:e.Plant.filter((e=>e.color)).map((e=>{const{color:t}=e,a=(0,D.A)(e,J);return(0,p.A)((0,p.A)({},a),{},{PlantType:"green"===t?"New":"old"})}))}}))};console.log("Payload for the Save is :",r);try{return await(0,g.Fd)("POST","https://saasimplementationserverdev.azurewebsites.net/flowDownCA/processMFGCA",r)}catch(c){throw console.error("Failed to send CA save data:",c),c}},Y=async(e,t,a)=>{var o,n,s;const l=(null===(o=t.initialDraggedData)||void 0===o||null===(n=o.data)||void 0===n||null===(s=n.items)||void 0===s?void 0:s[0])||{},i=t.cardData||{},r={CATitle:i.Title,CAId:l.objectId,CAOrganization:i.organization,CACollabSpace:i["Collaborative Space"],CAOwner:"e1331143",Items:e.map((e=>{var t;const o=a.find((t=>t.ItemId===e.ItemId)),n=a.find((t=>t.ItemId===e.ItemId)),s=(null===n||void 0===n||null===(t=n.ItemPlants)||void 0===t?void 0:t.length)>0&&n.ItemPlants.every((t=>e.Plant.some((e=>e.PlantID===t.PlantID&&"red"===e.color)))),l=null===o||void 0===o?void 0:o.hasNoPlants;return{ItemId:e.ItemId,ItemType:(null===o||void 0===o?void 0:o.ItemType)||"VPMReference",ItemState:(null===o||void 0===o?void 0:o.ItemState)||"IN_WORK",ItemTitle:e.ItemName,ItemMBOM:(null===o||void 0===o?void 0:o.ItemMBOM)||"N/A",AllPlantsRemoved:!(l||!s),ItemPlants:e.Plant.map((t=>{var o;const n=a.find((t=>t.ItemId===e.ItemId)),s=null===n||void 0===n||null===(o=n.ItemPlants)||void 0===o?void 0:o.some((e=>e.PlantID===t.PlantID)),l="green"===t.color,i="red"===t.color;return s&&i?{PlantName:t.PlantName,PlantID:t.PlantID,PlantType:"Remove"}:s&&!i?{PlantName:t.PlantName,PlantID:t.PlantID,PlantType:""}:!s&&i?null:!s&&l?{PlantName:t.PlantName,PlantID:t.PlantID,PlantType:"New"}:null})).filter(Boolean)}}))};console.log("Payload for Engineering CA Save is:",r);try{return await(0,g.Fd)("POST","https://saasimplementationserverdev.azurewebsites.net/plantAssignment/processENGCA",r)}catch(c){throw console.error("Failed to send CA save data:",c),c}};let Z=null;function Q(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let a=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");a||(a=document.createElement("div"),a.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(a):document.body.appendChild(a)),Z||(Z=n.createRoot(a)),Z.render((0,y.jsxs)(s.Kq,{store:l.A,children:[(0,y.jsx)(S,{}),(0,y.jsx)($,{}),(0,y.jsx)(i.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=811.2afe6c45.chunk.js.map