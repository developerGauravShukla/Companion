"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[357],{6313:(e,t,o)=>{o.d(t,{A:()=>r});o(5043);var n=o(4104),s=o(4282),a=o(579);const r=e=>{let{show:t,onHide:o,title:r,children:i,footerButtons:l}=e;return(0,a.jsxs)(n.A,{show:t,onHide:o,size:"lg",centered:!0,children:[(0,a.jsx)(n.A.Header,{closeButton:!0,children:(0,a.jsx)(n.A.Title,{children:r||"Modal Title"})}),(0,a.jsx)(n.A.Body,{children:i}),(0,a.jsx)(n.A.Footer,{children:l?l.map(((e,t)=>(0,a.jsx)(s.A,{variant:e.variant||"secondary",onClick:e.onClick,children:e.label},t))):(0,a.jsx)(s.A,{variant:"secondary",onClick:o,children:"Close"})})]})}},5362:(e,t,o)=>{o.d(t,{A:()=>c});var n=o(5043),s=o(8931),a=o(7111),r=o(3277),i=o(2725),l=o(579);const c=(0,n.forwardRef)(((e,t)=>{let{data:o,columns:c,addedItem:d,CAName:u,state:m}=e;const{showWarningToast:p}=(0,i.A)(),[g,f]=(0,n.useState)({});(0,n.useEffect)((()=>{f({})}),[o]);const h=()=>{const e=w.getSelectedRowModel().rows.map((e=>e.original["Available Plant"]));0!==e.length?(d(e),f({})):p(r.e1)};(0,n.useImperativeHandle)(t,(()=>({addPlant:h})));const v=(0,n.useMemo)((()=>[{id:"select",cell:e=>{let{row:t}=e;return(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",checked:t.getIsSelected(),onChange:t.getToggleSelectedHandler()})}},...c]),[c]),w=(0,s.N4)({data:o,columns:v,state:{rowSelection:g},enableRowSelection:!0,onRowSelectionChange:f,getCoreRowModel:(0,a.HT)()});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{type:"button",className:"btn btn-outline-primary me-3",onClick:()=>{w.getRowModel().rows.forEach((e=>e.toggleSelected(!0)))},children:"Select All"}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{w.getRowModel().rows.forEach((e=>e.toggleSelected(!1)))},children:"Deselect All"})]}),w.getRowModel().rows.length>0?(0,l.jsx)("div",{className:"overflow-auto",style:{maxHeight:"60vh"},children:w.getRowModel().rows.map((e=>(0,l.jsxs)("div",{className:"p-3 border-bottom d-flex align-items-center",style:{backgroundColor:e.getIsSelected()?"#d5e8f2":"inherit"},children:[(0,l.jsx)("div",{className:"me-3",children:(0,s.Kv)(e.getVisibleCells()[0].column.columnDef.cell,e.getVisibleCells()[0].getContext())}),(0,l.jsx)("div",{children:e.original[c[0].accessorKey]})]},e.id)))}):(0,l.jsx)("p",{className:"text-muted p-3",children:"No data available"})]})}))},5040:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_});var n=o(5043),s=o(4391),a=(o(2342),o(9555),o(3003)),r=o(2670),i=o(2115),l=(o(8421),o(4050),o(9959),o(174)),c=o(2725),d=o(3277),u=o(6713),m=o(5645),p=o(6047);var g=o(9379);const f=async(e,t)=>{let o={CAAtt:[]};console.log("We are into Search CA Details");const n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";try{const a=await(0,p.fV)(),r=async e=>new Promise(((o,n)=>{a.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),o(e)},onFailure:e=>{console.error("Request failed:",e),n(e)}})}));let i="".concat(n,"/resources/v1/modeler/dsrt/routes/search?searchStr=").concat(e);const l=await r(i),c=((null===l||void 0===l?void 0:l.data)||[]).find((e=>"Route"===e.type));if(c){const t=c.identifier,s=c.state,a="".concat(n,"/resources/v1/modeler/dsrt/routes/").concat(t),i=await r(a),l=((null===i||void 0===i?void 0:i.data)||[]).find((e=>"Change Action"===e.type));if(l){const e=l.identifier,t="".concat(n,"/resources/v1/modeler/dslc/changeaction/").concat(e,"?$fields=proposedChanges,flowDown"),s=await r(t);if(s)for(const a of s.isFlowDownOf||[])if("Change Action"===a.type){const e="".concat(n,"/resources/v1/modeler/dslc/changeaction/").concat(a.identifier),t=await r(e);t&&o.CAAtt.push({CATitle:t.title,CAState:t.state})}}o.MCOState=s,o.MCOTitle=e}else{var s;const t=e.split("-").slice(0,2).join("-");let a="".concat(n,"/resources/v1/modeler/dslc/changeaction/search?$searchStr=name:").concat(t);const i=null===(s=(await r(a)).changeAction[0])||void 0===s?void 0:s.identifier,l="".concat(n,"/resources/v1/modeler/dslc/changeaction/").concat(i,"?$fields=proposedChanges,flowDown"),c=await r(l);if(c)for(const e of c.isFlowDownOf||[])if("Change Action"===e.type){const t="".concat(n,"/resources/v1/modeler/dslc/changeaction/").concat(e.identifier),s=await r(t);s&&o.CAAtt.push({CATitle:s.title,CAState:s.state})}o.MCOState="Complete",o.MCOTitle=e}return console.log("Final CA Details",o),o}catch(a){throw console.error("Error in SearchCA:",a),a}};var h=o(9722);const v=async(e,t,o,n,s)=>{try{const t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",n=await async function(e,t,o){const n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",s="".concat(n,"/resources/v1/modeler/dslc/version/getGraph");let a="";try{const r={data:[{id:e,identifier:e,type:t,source:n,relativePath:"Raw_Material"===t?"/resources/v1/modeler/dsrm/dsrm:RawMaterial/".concat(e):"/resources/v1/modeler/dseng/dseng:EngItem/".concat(e)}]},i=await(0,p.ui)("POST",s,r,o);if(i.status&&i.output){const t=i.output.results[0].versions;for(const o of t)if(o.identifier===e&&(console.log("Found matching version for ID:",e),Array.isArray(o.ancestors)&&o.ancestors.length>0)){a=o.ancestors[0].id,console.log("Ancestor ID:",a);break}return a}return console.error("API response does not contain the expected 'status' and 'output'."),a}catch(r){return console.error("Error fetching getLatestRevision for ".concat(e,":"),r),a}}(o,s,e);if(console.log("Hello getLatestRevision is Called",n),""===n)return console.warn("No latest revision ID found."),[];{const l="".concat(t,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(n,"?$mask=dslib:ClassificationAttributesMask"),c=await(0,p.ui)("GET",l,"",e);if(!c.status||!c.output)return console.error("Invalid classification response from ENOVIA."),[];{var a,r;const e=((null===(a=c.output.member[0])||void 0===a||null===(r=a.ClassificationAttributes)||void 0===r?void 0:r.member)||[]).filter((e=>e.Attributes.some((e=>"PlantAssignmentClass"===e.name&&!0===e.value)))).map((e=>{const t=e.Attributes.map((e=>"Seq"===e.name?{name:e.name,value:String(Number(e.value)+1)}:"PlantStatus"===e.name?{name:e.name,value:"Pending"}:"AddSeq"===e.name||"PlantAssignmentClass"===e.name?{name:e.name,value:e.value}:{name:e.name,value:""}));return{ClassID:e.ClassID,Attributes:t}}));if(console.log("Matching ClassID and Seq:",e),!(e.length>0))return console.warn("No matching classifications found with Plant = True."),[];{const n="https://saasimplementationserverdev.azurewebsites.net/plantAssignment/classifyProductToClass",a={id:o,type:s,classes:e.map((e=>e.ClassID)),mode:"classifyParent"};try{const s=await w("POST",n,a);console.log("classifyResponse:",JSON.stringify(s));const r={source:t,type:"dslib:CategorizationClassifiedItem",identifier:o,relativePath:"resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/".concat(o)},i=[{referencedObject:r,categorizationAttributes:e.map((e=>({classId:e.ClassID,attributes:e.Attributes.reduce(((e,t)=>(e[t.name]=t.value,e)),{})})))}];console.log("Prepared payload for second API call:",JSON.stringify(i));const l="https://saasimplementationserverdev.azurewebsites.net/plantAssignment/updateClassificationAttribute?id=".concat(o),c=await w("PATCH",l,i);return console.log("Second API call response:",JSON.stringify(c)),e}catch(i){return console.error("Error during classify or second API call:",i),[]}}}}}catch(i){return console.error("[updateClasses] Failed to process:",i),[]}};const w=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("Fetching URL:",t),console.log("Method is:"),console.log("Request Body:",JSON.stringify(o,null,2));try{const n=await(0,h.A)({url:t,method:e,data:o});return console.log("Response received:",n.data),n}catch(n){throw console.error("Request failed:",n),n}},C="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",b=[];async function A(e,t){const o="".concat(C,"/resources/v1/modeler/dslib/dslib:Class/").concat(t);try{const t=await(0,p.ui)("GET",o,"",e);return t.output.totalItems>0&&t.output.member&&t.output.member.length>0&&t.output.member[0].title||null}catch(n){return console.error("Error fetching plant title for class ID ".concat(t,":"),n),null}}async function y(e,t){try{const o=await async function(e,t){const o="".concat(C,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(t,"?$mask=dslib:ClassificationAttributesMask");try{const t=await(0,p.ui)("GET",o,"",e);return console.log("Response from Plant Class IDs URL:",t),console.log("Response totalItems:",t.output.totalItems),t.output.totalItems>0&&t.output.member&&t.output.member.length>0&&t.output.member[0].ClassificationAttributes&&Array.isArray(t.output.member[0].ClassificationAttributes.member)?t.output.member[0].ClassificationAttributes.member.filter((e=>{const t=(e.Attributes||[]).find((e=>"PlantAssignmentClass"===e.name));return t&&!0===t.value})).map((e=>e.ClassID)):[]}catch(n){return console.error("Error fetching plant class IDs for ".concat(t,":"),n),[]}}(e,t);if(0===o.length)return[];const n=[];for(const t of o){const o=b.find((e=>e.classid===t));if(o)n.push(o.title);else{const o=await A(e,t);o&&(b.push({classid:t,title:o}),n.push(o))}}return n}catch(o){return console.error("Error fetching assigned plants for ".concat(t,":"),o),[]}}async function P(e,t){const o="".concat(C,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(t,"/expand"),n={expandDepth:1,withPath:!0};try{const t=await(0,p.ui)("POST",o,n,e);if(t.status&&t.output&&Array.isArray(t.output.member)){const o=t.output.member.filter((e=>e.type&&"DELFmiFunctionIdentifiedInstance"!==e.type));return await Promise.all(o.map((async t=>{const o=await y(e,t.id);return{id:t.id,type:t.type,name:t.name,title:t.title||null,AssignedPlants:o}})))}return[]}catch(s){return console.error("Error fetching children for identifier ".concat(t,":"),s),[]}}async function I(e,t,o){try{const n=await async function(e,t){const o="".concat(C,"/resources/v1/modeler/dsmfg/invoke/dsmfg:getMfgItemsFromEngItem"),n=[t];try{const t=await(0,p.ui)("POST",o,n,e);return t.output.totalItems>0&&Array.isArray(t.output.member)?t.output.member.map((e=>e.identifier)):[]}catch(s){return console.error("Error fetching manufacturing items:",s),[]}}(e,o);if(console.log("Manufacturing Identifiers:",n),0===n.length)return[];const s=await Promise.all(n.map((t=>async function(e,t){const o="".concat(C,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(t,"?$mask=dsmfg:MfgItemMask.Details");try{const t=await(0,p.ui)("GET",o,"",e);if(console.log("Response from Manufacturing Item URL:",t),console.log("Response totalItems:",t.output.totalItems),console.log("Response member:",t.output.member),t&&t.output&&t.output.totalItems>0&&Array.isArray(t.output.member)&&t.output.member.length>0){const e=t.output.member[0];return console.log("item:",e),{identifier:e.id,name:e.name,title:e.title,type:e.type,createdFrom:e.createdFrom||null}}return null}catch(n){return console.error("Error fetching details for identifier ".concat(t,":"),n),null}}(e,t))));console.log("Manufacturing Details:",s);const a=s.filter((e=>null!==e)),r=new Set(a.map((e=>e.createdFrom)).filter(Boolean).map((e=>e.split(" ")[0])));console.log("Created From Set:",r);const i=[];for(const o of a){const n=r.has(o.name),s=o.identifier===t;console.log("Processing item: ".concat(o.name,", isParent: ").concat(n,", currentObject: ").concat(s));const a=await y(e,o.identifier);console.log("Assigned Plants for Hello:",a);let l=[];(n||s)&&(l=await P(e,o.identifier)),i.push({identifier:o.identifier,name:o.name,title:o.title,type:o.type,isParent:n,currentObject:s,AssignedPlants:a,children:l})}return console.log("Prepared Data Output:",i),i}catch(n){return console.error("Error in prepareDataOutput:",n),[]}}const S="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",E=()=>{const{showErrorToast:e}=(0,c.A)(),t=(0,a.wA)();let o=window.widget.getValue("email");console.log("Email in usePlantAssignment:",o);return{handleCompanion:async(o,n,s,a)=>{try{t((0,m.Ve)(!0));const r=await(async()=>{try{let e=window.widget.getValue("Credentials");const t=await(0,p.fV)();console.log("Security Context is:",e);const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",n=await new Promise(((e,n)=>{t.authenticatedRequest(o,{method:"GET",type:"json",onComplete:e,onFailure:n})})),s=n.csrf.name,a=n.csrf.value,r="SecurityContext",i=e;return{[s]:a,[r]:i}}catch(e){return void console.error("[CSRF] Failed to fetch token:",e)}})();if(!r)return void e(d.rK);console.log("[UsePlantAssignment] Headers:",r);let i=[];if("Change Action"===a){const e=async()=>{const e=await(async(e,t)=>{try{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let n=[];console.log("[All Plant Service] CollabSpaces: ",e),console.log("[All Plant Service] headers: ",t);const s=await(0,p.fV)(),a=async e=>new Promise(((o,n)=>{s.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),o(e)},onFailure:e=>{console.error("Request failed:",e),n(e)}})})),r=e.map((async e=>{try{var t,s;const c="".concat(o,"/resources/v1/modeler/dslib/dslib:Library/search?$searchStr=").concat(e),d=null===(t=(await a(c)).member)||void 0===t||null===(s=t.find((t=>t.title===e)))||void 0===s?void 0:s.id;if(console.log("[All Plant Service] Library id is:",d),d){const e="".concat(o,"/resources/v1/modeler/dslib/dslib:Library/").concat(d,"?$mask=dslib:ExpandClassifiableClassesMask"),t=await a(e),{member:s}=t;if(s&&s.length>0){var r,i;console.log("[Library Data Service] Member found:",s);const e=null===(r=s[0])||void 0===r?void 0:r.ChildClasses;if((null===e||void 0===e||null===(i=e.member)||void 0===i?void 0:i.length)>0){var l;const t=null===(l=e.member[0].ChildClasses)||void 0===l?void 0:l.member;if(t&&t.length>0){const e=t.filter((e=>!n.some((t=>t.id===e.id))));n=[...n,...e]}}}}}catch(c){throw console.error("Error processing group:",e,c),c}}));return await Promise.all(r),n}catch(o){throw console.error("[All Plant Service] Error occurred:",o),o}})([o],r);return console.log("Parallel API response:",e),t((0,m.QL)(e)),e};let n=!1;console.log("The object Type is Change Action");const l=async e=>{const t="".concat(S,"/resources/v1/modeler/dslc/changeaction/").concat(s,"?%24fields=proposedChanges,realizedChanges"),o=await(0,p.ui)("GET",t,"",r);if(console.log("Response from Change Action URL:",o),o.status&&o.output){const t=o.output.realizedChanges.map((e=>e.where.identifier)),s=o.output.proposedChanges.map((async o=>{let s=o.where.identifier,l=o.where.type;if("Raw_Material"==l||"VPMReference"==l||"CreateAssembly"==l||"Provide"==l||"CreateMaterial"==l){if("NewVersion"===o.target){const e=await async function(e,t,o){const n="".concat(S,"/resources/v1/modeler/dslc/version/getGraph"),s="";try{const r="Raw_Material"===t?"/resources/v1/modeler/dsrm/dsrm:RawMaterial/".concat(e):"/resources/v1/modeler/dseng/dseng:EngItem/".concat(e),i={data:[{id:e,identifier:e,type:t,source:S,relativePath:r}]},l=await(0,p.ui)("POST",n,i,o);if(!l.status||!l.output)return console.error("API response does not contain the expected 'status' and 'output'."),s;{var a;const t=(null===(a=l.output.results[0])||void 0===a?void 0:a.versions)||[];for(const o of t)if(o.ancestors&&o.ancestors.some((t=>t.identifier===e)))return o.id}}catch(r){return console.error("Error fetching getLatestRevision for ".concat(e,":"),r),s}}(s,l,r);t.includes(e)&&(s=e)}if("Raw_Material"!==l&&"VPMReference"!==l){n=!0;const e=await D(s,r);console.log("MFG Details are:",e),s=e.identifier,l=e.type}if(void 0!==s&&void 0!==l)try{var c,d,u,m;const t=await async function(e,t,o){let n="";n="Raw_Material"===t?"".concat(S,"/resources/v1/modeler/dsrm/dsrm:RawMaterial/").concat(e):"".concat(S,"/resources/v1/modeler/dseng/dseng:EngItem/").concat(e,"?mask=dsmveng:EngItemMask.Details");try{const t=await(0,p.ui)("GET",n,"",o);return t.status&&t.output?t.output:(console.log("No valid response for identifier ".concat(e)),{})}catch(s){return console.error("Error fetching item details for ".concat(e,":"),s),{}}}(s,l,r),o=(null===t||void 0===t||null===(c=t.member)||void 0===c||null===(d=c[0])||void 0===d||d.state,await async function(e,t,o,n,s){const a=[];let r=!1;const i="".concat(S,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(e,"?$mask=dslib:ClassificationAttributesMask");try{var l,c;const n=await(0,p.ui)("GET",i,"",t);console.log("Response for identifier ".concat(e,":"),n);let d=(null===(l=n.output.member[0])||void 0===l||null===(c=l.ClassificationAttributes)||void 0===c?void 0:c.member)||[];d=d.filter((e=>{const t=e.Attributes.find((e=>"PlantAssignmentClass"===e.name)),o=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)||!0===(null===o||void 0===o?void 0:o.value)})),0===d.length&&(d=await v(t,0,e,0,s)),r=d.some((e=>{const t=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)})),d.length>0?d.forEach((e=>{const t=e.ClassID;let n=null,s=null,r=!1,i="";var l;(e.Attributes.forEach((e=>{e.name.includes("PlantAssignmentClass")&&(r=e.value),e.name.includes("PlantStatus")&&(s=e.value),e.name.includes("FlowDownCA")&&(i=e.value)})),r)&&(n=null===(l=o.find((e=>e.id===t)))||void 0===l?void 0:l.title,n&&a.push({PlantName:n,PlantID:t,PlantERPStatus:s||"Pending",PlantFlowDownCA:i}))})):console.log("No valid classification data for identifier ".concat(e))}catch(d){console.error("Error fetching assigned classes for ".concat(e,":"),d)}return{ItemPlants:a,hasNoPlants:r}}(s,r,e,0,a)),n=o.ItemPlants,g=o.hasNoPlants;console.log("Item Plants are:",n),console.log("Has No Plants are:",g),console.log("ItemObjectdetails:",o),i.push({ItemId:s,ItemType:l,ItemState:(null===t||void 0===t?void 0:t.member[0].state)||"N/A",ItemTitle:(null===t||void 0===t?void 0:t.member[0].title)||"N/A",ItemMBOM:(null===t||void 0===t||null===(u=t.member[0])||void 0===u||null===(m=u["dseno:EnterpriseAttributes"])||void 0===m?void 0:m.EMR_hasMBOM)||"N/A",ItemPlants:n,hasNoPlants:g})}catch(g){console.error("Error processing change for item ".concat(s,":"),g)}}}));await Promise.all(s)}else console.error("Invalid response structure or no proposed changes.")},c=await e();await l(c),t((0,m.Ve)(!1)),t((0,m.OL)(i)),t((0,m.Dr)(n)),t((0,m.lT)(r))}else{let e=[];const o=await D(s,r);if(console.log("[Use Companion] Scope Linked Data:",o),o.identifier){e=await async function(e,t){const o="".concat(S,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(t,"?$mask=dslib:ClassificationAttributesMask");try{const a=await(0,p.ui)("GET",o,"",e);if(a.status&&a.output){var n;const t=(null===(n=a.output.member[0].ClassificationAttributes)||void 0===n?void 0:n.member)||[],o=[];for(const n of t){var s;const t=n.ClassID,a=n.Attributes||[];if(null===(s=a.find((e=>"PlantAssignmentClass"===e.name)))||void 0===s?void 0:s.value){const n=await R(e,t);o.push({id:t,title:n})}}return o}return console.log("No valid response for object ID ".concat(t)),[]}catch(a){return console.error("Error fetching item details for ".concat(t,":"),a),[]}}(r,o.identifier);const n=await I(r,s,o.identifier);console.log("[Use Companion] Prepare Data Output:",n),t((0,m.VG)(n));const a=await async function(e,t){const o=await y(t),n=e.find((e=>!0===e.currentObject));if(!n)return console.warn("Current MFG item not found in prepared data output."),{AssignedPlants:[],AvailablePlants:o};const s=n.AssignedPlants||[],a=[];e.forEach((e=>{e.isParent||(e.AssignedPlants||[]).forEach((e=>{a.includes(e)||a.push(e)}))}));const r=o.filter((e=>!a.includes(e)));return console.log("Assigned Plants:",s),console.log("Available Plants:",r),{AssignedPlants:s,AvailablePlants:r}}(n,r);console.log("[Use Companion] Plant Lists:",a),t((0,m.Lq)(a))}if(console.log("[Companion] All Plants:",e),e.length>0){const o=await(async(e,t,o)=>{try{var n;const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";console.log("[Assigned Plant Service] Plant Members:",e);const a="".concat(s,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(o,"?$mask=dslib:ClassificationAttributesMask"),r=await(0,p.fV)(),i=await new Promise(((e,o)=>{r.authenticatedRequest(a,{method:"GET",headers:t,type:"json",onComplete:e,onFailure:o})}));console.log("[Assigned Plant Service] Data received:",i);let l=[],c=[],d=(null===(n=i.member[0].ClassificationAttributes)||void 0===n?void 0:n.member)||[];return await Promise.all(d.map((async o=>{console.log("Class Item is ",o);for(let n of e)if(o.ClassID===n.id){let e=n.title;e=e.replace("Plant","").replace(/\s+/g,"");let s={id:o.ClassID,title:n.title};const a=o.Attributes.map((o=>o.name.includes("FlowDownCA")&&o.value?f(o.value,t).then((e=>{if(e){console.log(e),s.MFGChange=null===e||void 0===e?void 0:e.MCOTitle,s.MFGStatus=null===e||void 0===e?void 0:e.MCOState;let t="",o="";e.CAAtt.forEach((e=>{t+=","+e.CATitle,o+=","+e.CAState})),s.Change=t.slice(1),s.ChangeStatus=o.slice(1)}})):(s[o.name.replace(e,"").trim()]=o.value,Promise.resolve())));await Promise.all(a),l=[...l,s],console.log("Initial Assigned Classes",l),console.log("Processed Object:",s)}}))),console.log("[Assigned Plant Service] Initial Assigned Classes:",l),c=e.filter((e=>!l.some((t=>t.id===e.id)))),console.log("uniqueInAllclasses--:",c),{success:!0,data:{plantData:{allPlants:e,initialAssignedPlants:l,uniquePlants:c,hasNoClass:!1}}}}catch(s){return console.error("[Object Details] Failed to fetch data:",s),{success:!1,error:s}}})(e,r,s);console.log("[Use Plant Assignment]: ",o),o.success?(t((0,m.Lq)(o.data.plantData)),console.log("[Use Plant Assignment] Plant Object Data:",o.data.plantData),t((0,m.lL)(r))):console.error("Failed to fetch plant data.")}else console.warn("[Use Plant Assignment] No Plants found.");let i={};i=["CreateKit","CreateAssembly","CreateMaterial","Provide","ProcessContinuousProvide","Raw_Material"].includes(a)?{success:!0,data:[]}:await(async(e,t)=>{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let n="".concat(o,"/resources/v1/modeler/dseng/dseng:EngItem/");n+=t,n+="/expand";let s={expandDepth:1,type_filter_bo:["VPMReference"],type_filter_rel:["VPMInstance"]};try{console.log("[SearchCAService] ProductId is:",t);const a=await(0,p.fV)(),r=(t,o,n)=>new Promise(((s,r)=>{a.authenticatedRequest(t,{method:o,headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(n),type:"json",onComplete:e=>{console.log("Received response:",e),s(e)},onFailure:e=>{console.error("Request failed:",e),r(e)}})})),i=await r(n,"POST",s);console.log("[Get CA Details Service] Data received:",i);const{member:l}=i;if(l){let e=i.member.filter((e=>("VPMReference"===e.type||"Raw_Material"===e.type)&&e.id!==t)).map((e=>({id:e.id,type:e.type,name:e.title,state:e.state})));return e.length>0&&await Promise.all(e.map((async e=>{if("released"===e.state.toLowerCase()){let t="".concat(o,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(e.id,"?$mask=dslib:ClassificationAttributesMask");const n=await r(t,"GET","");console.log("classResponse->",n);const s=n.member.flatMap((e=>{var t;return null!==(t=e.ClassificationAttributes)&&void 0!==t&&t.member?e.ClassificationAttributes.member.map((e=>e.ClassID)):[]}));e.classes=s}}))),{success:!0,data:e}}}catch(a){return console.error("Error while Fetching",a),{success:!1,data:[],error:a}}})(r,s),console.log("Type After:",a),console.log("[Use Plant Assignment] Product Children:",i),i.success&&t((0,m.VG)(i.data));const l=await(async(e,t,o)=>{const n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let s=!1,a=[],r={CAName:"",CAStatus:""};const i=["caproposedwhere_from","carealizedwhere_from"],l="".concat(n,"/resources/enorelnav/v2/navigate/setPreferences");let c={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",relations:["caproposedwhere_from","carealizedwhere_from"],allRelationsMode:!1,publicationsMode:!1,computeWithInstances:!1,attributesForView:["ds6w:status","ds6w:type","ds6w:identifier","ds6w:label"],label:"ENXENG_AP-e1331143-1734517777960",lang:"en",ghostMode:!1},d="".concat(n,"/resources/enorelnav/v2/navigate/getEcosystem"),u={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",responseMode:"objectsByPatterns",label:"ENXENG_AP-e1331143-1734517780491",ids:[t]};try{console.log("[Get CA Details] Product ID:",t);const m=await(0,p.fV)(),f=await new Promise(((t,o)=>{m.authenticatedRequest(l,{method:"POST",headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(c),type:"json",onComplete:t,onFailure:o})}));if(console.log("[Get CA Details Service] Data received:",f),"OK"===f.status){const l=await new Promise(((t,o)=>{m.authenticatedRequest(d,{method:"POST",headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(u),type:"json",onComplete:t,onFailure:o})}));console.log("[Get CA Details Service] Data received:",l);for(const c of i)l.objectsByPatterns[c]&&await Promise.all(l.objectsByPatterns[c].map((async i=>{const l=i["ds6w:status"].slice(14),d=i["ds6w:label"];if("Complete"!==l){const u="".concat(n,"/resources/v1/modeler/dslc/changeaction/").concat(i.id,"?$fields=proposedChanges,realizedChanges,flowDown"),p=await new Promise(((t,o)=>{m.authenticatedRequest(u,{method:"GET",headers:e,type:"json",onComplete:t,onFailure:o})}));console.log("response3 Data will appear:",p),"caproposedwhere_from"===c?Array.isArray(p.proposedChanges)&&p.proposedChanges.forEach((e=>{a.push({identifier:e.where.identifier,action:e.whats[0].what})})):Array.isArray(p.realizedChanges)&&p.realizedChanges.forEach((e=>{a.push({identifier:e.where.identifier,action:e.operations[0]})})),s="released"!==o.toLowerCase()||a.some((e=>e.identifier===t&&"Modify"===e.action)),s&&(r.CAName=d,r.CAStatus=l)}})))}else console.error("Unable to Fetch the ");return console.log("Status is coming inside 7"),console.log("Response Object is:",s),{success:!0,data:s,CAData:r,proposedChanges:a}}catch(m){throw console.error("Failed Request:",{url:l,headers:e,body:c,error:m}),m}})(r,s,n);console.log("[Use Plant Assignment] CA Details:",l),l.success&&(t((0,m.ug)(l.data)),t((0,m.aB)(l.proposedChanges)),t((0,m.hF)(l.CAData))),console.log("[Plant Assignment] All services executed successfully.")}}catch(r){console.error("[Plant Assignment] Error:",r),e("An error occurred while fetching plant assignment data.")}finally{t((0,m.Ve)(!1))}}}};async function D(e,t){let o="";o="".concat(S,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(e,"/dsmfg:ScopeEngItem");try{const n=await(0,p.ui)("GET",o,"",t);return n.status&&n.output?{identifier:n.output.member[0].ScopeEngItem.identifier,type:n.output.member[0].ScopeEngItem.type}:(console.log("No valid response for identifier ".concat(e)),{})}catch(n){return console.error("Error fetching item details for ".concat(e,":"),n),{}}}async function R(e,t){const o="".concat(S,"/resources/v1/modeler/dslib/dslib:Class/").concat(t);try{const n=await(0,p.ui)("GET",o,"",e);if(n.status&&n.output&&n.output.member&&n.output.member.length>0){return n.output.member[0].title||null}return console.log("No class found for classId ".concat(t)),null}catch(n){return console.error("Error fetching class title for classId ".concat(t,":"),n),null}}var j=o(314);const M=()=>{const{showErrorToast:e}=(0,c.A)(),{handleCompanion:t}=E(),o=(0,a.d4)((e=>e.droppedObject.isDropped)),s=(0,a.d4)((e=>e.droppedObject.loading)),r=(0,a.wA)(),i=(0,n.useCallback)((async o=>{try{const a=await(0,j.Sj)({dataItems:o});if(a.success){r((0,m.um)({cardData:a.data.cardData}));const e=a.data.cardData;var n,s;if(console.log("[Dragged Items are]",e),r((0,m.Rr)(!0)),a)await t(e["Collaborative Space"],e["Maturity State"],null===(n=o[0])||void 0===n?void 0:n.objectId,null===(s=o[0])||void 0===s?void 0:s.objectType)}else e(d.wX)}catch(a){console.error("[FetchObjectDetails] Error fetching details:",a),e(d.wX)}finally{r((0,m.r1)(!1))}}),[r,t]),l=(0,n.useCallback)((async t=>{console.log("[handleDrop] handleDrop called with dataItems:",t);try{if(t&&t.length>0){var o;const n=null===(o=t[0])||void 0===o?void 0:o.objectType;if(!["CreateKit","CreateAssembly","CreateMaterial","Provide","ProcessContinuousProvide"].includes(n))return void e(d.$E);r((0,m.Rr)(!0)),console.log("[handleDrop] \ud83d\udd04 Force setting `loading = true`..."),r((0,m.r1)(!1)),setTimeout((()=>r((0,m.r1)(!0))),0),await i(t)}else console.warn("[handleDrop] No data items to process.")}catch(n){console.error("[Drop] Error in handleDrop:",n),r((0,m.r1)(!1)),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(d.nz)}}),[i,e]);return{initializeDroppableArea:(0,n.useCallback)((()=>{o?console.log("[initializeDroppableArea] \u23f3 isDropped is already true. Skipping reset."):(console.log("[initializeDroppableArea] \ud83d\ude80 Resetting isDropped to false..."),r((0,m.Rr)(!1)));const t=setInterval((()=>{const o=document.querySelector(".droppable-container");o&&(clearInterval(t),(0,j.pn)(o,l,r,e))}),100);return()=>clearInterval(t)}),[l,r]),loading:s,handleDrop:l}};var N=o(579);const x=()=>{const{handleDrop:e}=M(),{showSuccessToast:t,showErrorToast:o}=(0,c.A)(),[s,a]=(0,n.useState)(!1);console.log("---[WidgetLifecycle]--- starts");return(0,n.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var n,s;const i=(new Error).stack.split("\n"),c=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(i)&&!c)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),a(!0);const u=r.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===u||void 0===u||null===(n=u.data)||void 0===n||null===(s=n.items)||void 0===s||!s.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",u),void a(!1);try{await(0,l.M)(u.data.items,e)}catch(m){console.error("[WidgetLifecycle] \u274c Error during refresh:",m),o(d.H6)}finally{a(!1),t(d._l)}}))}),[]),s?(0,N.jsx)(u.A,{}):null};var O=o(5362),T=o(6313);o(3728);const k=e=>{let{onAddPlant:t,addedPlant:o,onSave:s,onRemove:a,uniquedata:r,uniqueColumn:i,CAName:l,state:u,type:m,isMFGCA:p,CAData:g,hasChanges:f,onCancel:h,setHasChanges:v}=e;const{showWarningToast:w,showSuccessToast:C}=(0,c.A)(),b=e=>"Approved"===e||"In Approval"===e||"Completed"===e,[A,y]=(0,n.useState)(!1),P=(0,n.useRef)();console.log("[Unique Table Data]:",r);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:"d-flex cta-absolute",children:[!p&&(0,N.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{b(u)?w(d.rz):"Change Action"===m||l?y(!0):w("RELEASED"===u?d.sL:d.Ru)},children:"Add Plant"}),p&&(0,N.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{"Approved"===u||"In Approval"===u||"Completed"===u?w(d.rz):y(!0)},children:"Add/Update Plants"}),"Change Action"===m&&(0,N.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>{b(u)?w(d.rz):s&&("Change Action"===m||l)?s():w("RELEASED"===u?d.EZ:d.nX)},children:"Save"}),!1===p&&(0,N.jsx)("button",{className:"btn btn-outline-danger btn-lg m-2",onClick:()=>{b(u)?w(d.rz):a&&a()},children:"Remove"}),f&&(0,N.jsx)("button",{className:"btn btn-outline-secondary btn-lg m-2",onClick:h,children:"Cancel"})]}),(0,N.jsx)(T.A,{show:A,onHide:()=>y(!1),title:"Available Plant",footerButtons:[{label:"Add",variant:"primary",onClick:()=>{var e;null===(e=P.current)||void 0===e||e.addPlant(),y(!1)}},{label:"Close",variant:"danger",onClick:()=>y(!1)}],children:(0,N.jsx)("div",{className:"modal-body",children:(0,N.jsx)(O.A,{ref:P,data:r,columns:i,CAName:l,addedItem:e=>{if(console.log(e),"Change Action"===m)e.length>0&&(t(e),o(e),v&&v(!0));else if(e.length>0){const n=e.map((e=>({title:e,Seq:"1",Status:"Pending","MFG Change":"N/A","MFG Status":"N/A",Change:g.CAName,"Change Status":g.CAStatus,"Oracle Template":"N/A","ERP Status":"Active","ERP Export":"Yes","Lead Plant":"false",MBom:"N/A","Sort Value":""})));t(n),o(e),v&&v(!0)}},state:u})})})]})};var F=o(768);const L=()=>{const[e,t]=(0,n.useState)([]),[o,s]=(0,n.useState)(0),[r,i]=(0,n.useState)([]),[l,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!1),m=(0,a.d4)((e=>e.droppedObject.CAItemObjectDetails.CAItemDetails)),p=(0,a.d4)((e=>e.droppedObject.CAItemObjectDetails.CAallPlants)),f=(0,a.d4)((e=>e.droppedObject.CAItemObjectDetails.CAisMFGCA)),h=(0,a.d4)((e=>e.droppedObject.selectedTableRows)),v=(0,a.d4)((e=>{var t,o,n,s,a;return null===(t=e.droppedObject.droppedObjectData)||void 0===t||null===(o=t.initialDraggedData)||void 0===o||null===(n=o.data)||void 0===n||null===(s=n.items)||void 0===s||null===(a=s[0])||void 0===a?void 0:a.objectType})),w=(0,a.d4)((e=>e.droppedObject.plantObjectData.uniquePlants)),C=(0,n.useCallback)((()=>{let e=p.map((e=>e.title.replace(/^Plant /,"")));const t=0===h.length?l:h;let o=[...new Set(t.flatMap((e=>{var t,o;return(null===(t=e.Plant)||void 0===t||null===(o=t.map)||void 0===o?void 0:o.call(t,(e=>e.PlantName)))||[]})))],n=e.filter((e=>!o.includes(e))).map((e=>({title:e})));return f?e.map((e=>({title:e}))):n}),[p,l,h,f]);(0,n.useEffect)((()=>{"Change Action"===v&&t(C())}),[C,v]),(0,n.useEffect)((()=>{"Change Action"!==v&&t(w)}),[w,v]);const b=(0,n.useMemo)((()=>e.map((e=>(0,g.A)({},e)))),[e]),A=(0,n.useMemo)((()=>[{Header:"Plant Name",accessor:"PlantName"},{Header:"Plant ID",accessor:"PlantID"},{Header:"PlantERPStatus",accessor:"PlantERPStatus"},{Header:"Color",accessor:"color"}]),[]),y=(0,n.useCallback)((e=>{s((e=>e+1)),"Change Action"===v&&i((t=>t.map((t=>{if(!(0===h.length||h.some((e=>e.ItemId===t.ItemId))))return t;const o=m.find((e=>e.ItemId===t.ItemId)),n=(null===o||void 0===o?void 0:o.ItemPlants)||[],s=t.ItemPlants||[],a=s.map((t=>f&&e.includes(t.PlantName.trim())&&n.some((e=>e.PlantName.trim()===t.PlantName.trim()))?(0,g.A)((0,g.A)({},t),{},{color:"red"}):t)),r=[];return e.forEach((e=>{const t=p.find((t=>t.title.replace(/^Plant\s+/,"").trim()===e.trim()));if(!t)return;const o=n.some((t=>t.PlantName.trim()===e.trim()));s.some((t=>t.PlantName.trim()===e.trim()))||r.push((0,g.A)({PlantName:e,PlantID:t.id,PlantERPStatus:"Pending"},o?{color:"red"}:{color:"green"}))})),c((e=>[...e,...r])),(0,g.A)((0,g.A)({},t),{},{ItemPlants:[...a,...r]})})))),u(!0)}),[p,m,f,h,v,i,c]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(k,{uniquedata:b,onAddPlant:y,hasChanges:d,setHasChanges:u}),(0,N.jsx)("div",{style:{marginTop:"2rem"},children:(0,N.jsx)(F.A,{data:l,columns:A},o)})]})};let G=null;function _(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let o=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");o||(o=document.createElement("div"),o.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(o):document.body.appendChild(o)),G||(G=s.createRoot(o)),G.render((0,N.jsxs)(a.Kq,{store:r.A,children:[(0,N.jsx)(x,{}),(0,N.jsx)(L,{}),(0,N.jsx)(i.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=357.26f4f68d.chunk.js.map