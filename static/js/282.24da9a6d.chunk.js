"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[282],{5370:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A,start:()=>_});var s=n(5043),i=n(4391),l=(n(2342),n(9555),n(3003)),r=n(2670),a=n(2115),o=(n(8421),n(4050),n(9959),n(174)),d=n(2725),c=n(3277),u=n(6713);const h=()=>{const[e,t]=(0,s.useState)(null),[n,i]=(0,s.useState)(!1);return{droppedData:e,isDropped:n,handleDrop:e=>{t(e),i(!0)},resetDrop:()=>{t(null),i(!1)}}},p=()=>{const{droppedData:e,isDropped:t,handleDrop:n,resetDrop:s}=h();return{initializeDroppableArea:s,isDropped:t,droppedData:e,handleDrop:n}};var m=n(579);const f=()=>{const{handleDrop:e}=p(),{showSuccessToast:t,showErrorToast:n}=(0,d.A)(),[i,l]=(0,s.useState)(!1);console.log("---[WidgetLifecycle]--- starts");return(0,s.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var s,i;const a=(new Error).stack.split("\n"),d=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(a)&&!d)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),l(!0);const u=r.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===u||void 0===u||null===(s=u.data)||void 0===s||null===(i=s.items)||void 0===i||!i.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",u),void l(!1);try{await(0,o.M)(u.data.items,e)}catch(h){console.error("[WidgetLifecycle] \u274c Error during refresh:",h),n(c.H6)}finally{l(!1),t(c._l)}}))}),[]),i?(0,m.jsx)(u.A,{}):null};n(4119);var g=n(3637),w=n(4282),x=n(2691),j=n(1397),v=n(4675),b=n(7419),y=n(3910),D=n(7929);const C=e=>{let{handleFileInputChange:t,fileInputRef:n,isFileInputDisabled:s,handleSubmit:i,isCreateButtonDisabled:l,handleReset:r}=e;const{handleDrop:a}=(0,b.A)(),{performSearch:o}=(0,v.A)();return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("div",{className:"droppable-container mt-4",children:[(0,m.jsx)(g.A,{style:{width:"90px",height:"65px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,m.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop"}),(0,m.jsxs)("div",{className:"divider-container",children:[(0,m.jsx)("hr",{className:"divider"}),(0,m.jsx)("span",{className:"divider-text",children:"or"}),(0,m.jsx)("hr",{className:"divider"})]}),(0,m.jsx)(j.A,{onSearch:e=>{o(e,{title:"Search",role:"",mode:"furtive",default_with_precond:!0,precond:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/Raw_Material" OR flattenedtaxonomies:"types/Document"',show_precond:!1,multiSel:!1,idcard_activated:!1,select_result_max_idcard:!1,itemViewClickHandler:"",search_delegation:"3dsearch"},(e=>{console.log("Selected objects:",e),console.log("objectId: selectedObjects[0].id",e[0].id),e&&e.length>0&&e[0].id?a([{objectId:e[0].id,objectType:e[0]["ds6w:type_value"]}]):console.warn("No objectId found in selected objects")}))}}),(0,m.jsx)("div",{className:"mt-3",children:(0,m.jsxs)("div",{className:"row justify-content-center",children:[(0,m.jsx)("div",{className:"col-6 col-md-auto mb-2",children:(0,m.jsx)(w.A,{variant:"link ms-auto",onClick:()=>{const e=document.createElement("a");e.href="https://github.com/aayush825/EMR_PLANT_WIDGET/raw/main/plant_assignment_template.xlsx",e.download="plant_assignment_template.xlsx",e.click()},children:"Download Template"})}),(0,m.jsx)("div",{className:"col-6 col-md-auto mb-2",children:(0,m.jsx)(x.A.Group,{controlId:"formFileMultiple",children:(0,m.jsx)(x.A.Control,{type:"file",multiple:!0,onChange:t,disabled:s,ref:n})})}),(0,m.jsx)("div",{className:"col-6 col-md-auto mb-2",children:(0,m.jsx)(w.A,{variant:"outline-danger",onClick:r,children:(0,m.jsx)(y.g,{icon:D.ub2})})}),(0,m.jsx)("div",{className:"col-6 col-md-auto mb-2",children:(0,m.jsx)("div",{style:{display:"inline-block",cursor:l?"not-allowed":"pointer"},children:(0,m.jsx)(w.A,{variant:l?"secondary":"outline-primary",onClick:i,disabled:l,children:"Create Manufacturing CA"})})})]})})]})})},S=()=>{const[e,t]=(0,s.useState)(!1),[n,i]=(0,s.useState)(!1),l=(0,s.useRef)(null),[r,a]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!0);return(0,m.jsxs)(m.Fragment,{children:[!e&&!n&&(0,m.jsx)("div",{style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",position:"relative"},children:(0,m.jsx)(C,{handleFileInputChange:()=>{},fileInputRef:l,isFileInputDisabled:r,handleSubmit:()=>{},isCreateButtonDisabled:o,handleReset:()=>{}})}),e&&(0,m.jsx)("div",{className:"content-wrapper py-3 border-bottom",children:(0,m.jsxs)("div",{className:"d-flex ",children:[(0,m.jsx)("div",{className:" p-0 pt-4"}),(0,m.jsx)("div",{style:{width:"100%"},children:(0,m.jsxs)("table",{className:"table",children:[(0,m.jsx)("thead",{children:(0,m.jsx)("tr",{children:(0,m.jsx)("th",{children:"Plant"})})}),(0,m.jsx)("tbody",{})]})})]})})]})};let k=null;function _(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let n=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");n||(n=document.createElement("div"),n.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(n):document.body.appendChild(n)),k||(k=i.createRoot(n)),k.render((0,m.jsxs)(l.Kq,{store:r.A,children:[(0,m.jsx)(f,{}),(0,m.jsx)(S,{}),(0,m.jsx)(a.N9,{})]}))}function A(){window.widget&&_()}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=282.24da9a6d.chunk.js.map