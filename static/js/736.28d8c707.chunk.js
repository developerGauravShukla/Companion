"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[736],{6313:(e,t,o)=>{o.d(t,{A:()=>r});o(5043);var s=o(4104),n=o(4282),a=o(579);const r=e=>{let{show:t,onHide:o,title:r,children:i,footerButtons:l}=e;return(0,a.jsxs)(s.A,{show:t,onHide:o,size:"lg",centered:!0,children:[(0,a.jsx)(s.A.Header,{closeButton:!0,children:(0,a.jsx)(s.A.Title,{children:r||"Modal Title"})}),(0,a.jsx)(s.A.Body,{children:i}),(0,a.jsx)(s.A.Footer,{children:l?l.map(((e,t)=>(0,a.jsx)(n.A,{variant:e.variant||"secondary",onClick:e.onClick,children:e.label},t))):(0,a.jsx)(n.A,{variant:"secondary",onClick:o,children:"Close"})})]})}},5362:(e,t,o)=>{o.d(t,{A:()=>c});var s=o(5043),n=o(8931),a=o(7111),r=o(3277),i=o(2725),l=o(579);const c=(0,s.forwardRef)(((e,t)=>{let{data:o,columns:c,addedItem:d,CAName:u,state:m}=e;const{showWarningToast:p}=(0,i.A)(),[g,f]=(0,s.useState)({});(0,s.useEffect)((()=>{f({})}),[o]);const h=()=>{const e=w.getSelectedRowModel().rows.map((e=>e.original["Available Plant"]));0!==e.length?(d(e),f({})):p(r.e1)};(0,s.useImperativeHandle)(t,(()=>({addPlant:h})));const v=(0,s.useMemo)((()=>[{id:"select",cell:e=>{let{row:t}=e;return(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",checked:t.getIsSelected(),onChange:t.getToggleSelectedHandler()})}},...c]),[c]),w=(0,n.N4)({data:o,columns:v,state:{rowSelection:g},enableRowSelection:!0,onRowSelectionChange:f,getCoreRowModel:(0,a.HT)()});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{type:"button",className:"btn btn-outline-primary me-3",onClick:()=>{w.getRowModel().rows.forEach((e=>e.toggleSelected(!0)))},children:"Select All"}),(0,l.jsx)("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>{w.getRowModel().rows.forEach((e=>e.toggleSelected(!1)))},children:"Deselect All"})]}),w.getRowModel().rows.length>0?(0,l.jsx)("div",{className:"overflow-auto",style:{maxHeight:"60vh"},children:w.getRowModel().rows.map((e=>(0,l.jsxs)("div",{className:"p-3 border-bottom d-flex align-items-center",style:{backgroundColor:e.getIsSelected()?"#d5e8f2":"inherit"},children:[(0,l.jsx)("div",{className:"me-3",children:(0,n.Kv)(e.getVisibleCells()[0].column.columnDef.cell,e.getVisibleCells()[0].getContext())}),(0,l.jsx)("div",{children:e.original[c[0].accessorKey]})]},e.id)))}):(0,l.jsx)("p",{className:"text-muted p-3",children:"No data available"})]})}))},2898:(e,t,o)=>{o.r(t),o.d(t,{default:()=>G});var s=o(5043),n=o(4391),a=(o(2342),o(9555),o(3003)),r=o(2670),i=o(2115),l=(o(8421),o(4050),o(9959),o(174)),c=o(2725),d=o(3277),u=o(6713),m=o(5645),p=o(6047);var g=o(9379);const f=async(e,t)=>{let o={CAAtt:[]};console.log("We are into Search CA Details");const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";try{const a=await(0,p.fV)(),r=async e=>new Promise(((o,s)=>{a.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),o(e)},onFailure:e=>{console.error("Request failed:",e),s(e)}})}));let i="".concat(s,"/resources/v1/modeler/dsrt/routes/search?searchStr=").concat(e);const l=await r(i),c=((null===l||void 0===l?void 0:l.data)||[]).find((e=>"Route"===e.type));if(c){const t=c.identifier,n=c.state,a="".concat(s,"/resources/v1/modeler/dsrt/routes/").concat(t),i=await r(a),l=((null===i||void 0===i?void 0:i.data)||[]).find((e=>"Change Action"===e.type));if(l){const e=l.identifier,t="".concat(s,"/resources/v1/modeler/dslc/changeaction/").concat(e,"?$fields=proposedChanges,flowDown"),n=await r(t);if(n)for(const a of n.isFlowDownOf||[])if("Change Action"===a.type){const e="".concat(s,"/resources/v1/modeler/dslc/changeaction/").concat(a.identifier),t=await r(e);t&&o.CAAtt.push({CATitle:t.title,CAState:t.state})}}o.MCOState=n,o.MCOTitle=e}else{var n;const t=e.split("-").slice(0,2).join("-");let a="".concat(s,"/resources/v1/modeler/dslc/changeaction/search?$searchStr=name:").concat(t);const i=null===(n=(await r(a)).changeAction[0])||void 0===n?void 0:n.identifier,l="".concat(s,"/resources/v1/modeler/dslc/changeaction/").concat(i,"?$fields=proposedChanges,flowDown"),c=await r(l);if(c)for(const e of c.isFlowDownOf||[])if("Change Action"===e.type){const t="".concat(s,"/resources/v1/modeler/dslc/changeaction/").concat(e.identifier),n=await r(t);n&&o.CAAtt.push({CATitle:n.title,CAState:n.state})}o.MCOState="Complete",o.MCOTitle=e}return console.log("Final CA Details",o),o}catch(a){throw console.error("Error in SearchCA:",a),a}};var h=o(9722);const v=async(e,t,o,s,n)=>{try{const t="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",s=await async function(e,t,o){const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",n="".concat(s,"/resources/v1/modeler/dslc/version/getGraph");let a="";try{const r={data:[{id:e,identifier:e,type:t,source:s,relativePath:"Raw_Material"===t?"/resources/v1/modeler/dsrm/dsrm:RawMaterial/".concat(e):"/resources/v1/modeler/dseng/dseng:EngItem/".concat(e)}]},i=await(0,p.ui)("POST",n,r,o);if(i.status&&i.output){const t=i.output.results[0].versions;for(const o of t)if(o.identifier===e&&(console.log("Found matching version for ID:",e),Array.isArray(o.ancestors)&&o.ancestors.length>0)){a=o.ancestors[0].id,console.log("Ancestor ID:",a);break}return a}return console.error("API response does not contain the expected 'status' and 'output'."),a}catch(r){return console.error("Error fetching getLatestRevision for ".concat(e,":"),r),a}}(o,n,e);if(console.log("Hello getLatestRevision is Called",s),""===s)return console.warn("No latest revision ID found."),[];{const l="".concat(t,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(s,"?$mask=dslib:ClassificationAttributesMask"),c=await(0,p.ui)("GET",l,"",e);if(!c.status||!c.output)return console.error("Invalid classification response from ENOVIA."),[];{var a,r;const e=((null===(a=c.output.member[0])||void 0===a||null===(r=a.ClassificationAttributes)||void 0===r?void 0:r.member)||[]).filter((e=>e.Attributes.some((e=>"PlantAssignmentClass"===e.name&&!0===e.value)))).map((e=>{const t=e.Attributes.map((e=>"Seq"===e.name?{name:e.name,value:String(Number(e.value)+1)}:"PlantStatus"===e.name?{name:e.name,value:"Pending"}:"AddSeq"===e.name||"PlantAssignmentClass"===e.name?{name:e.name,value:e.value}:{name:e.name,value:""}));return{ClassID:e.ClassID,Attributes:t}}));if(console.log("Matching ClassID and Seq:",e),!(e.length>0))return console.warn("No matching classifications found with Plant = True."),[];{const s="https://saasimplementationserverdev.azurewebsites.net/plantAssignment/classifyProductToClass",a={id:o,type:n,classes:e.map((e=>e.ClassID)),mode:"classifyParent"};try{const n=await w("POST",s,a);console.log("classifyResponse:",JSON.stringify(n));const r={source:t,type:"dslib:CategorizationClassifiedItem",identifier:o,relativePath:"resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/".concat(o)},i=[{referencedObject:r,categorizationAttributes:e.map((e=>({classId:e.ClassID,attributes:e.Attributes.reduce(((e,t)=>(e[t.name]=t.value,e)),{})})))}];console.log("Prepared payload for second API call:",JSON.stringify(i));const l="https://saasimplementationserverdev.azurewebsites.net/plantAssignment/updateClassificationAttribute?id=".concat(o),c=await w("PATCH",l,i);return console.log("Second API call response:",JSON.stringify(c)),e}catch(i){return console.error("Error during classify or second API call:",i),[]}}}}}catch(i){return console.error("[updateClasses] Failed to process:",i),[]}};const w=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("Fetching URL:",t),console.log("Method is:"),console.log("Request Body:",JSON.stringify(o,null,2));try{const s=await(0,h.A)({url:t,method:e,data:o});return console.log("Response received:",s.data),s}catch(s){throw console.error("Request failed:",s),s}},b="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",C=[];async function A(e,t){const o="".concat(b,"/resources/v1/modeler/dslib/dslib:Class/").concat(t);try{const t=await(0,p.ui)("GET",o,"",e);return t.output.totalItems>0&&t.output.member&&t.output.member.length>0&&t.output.member[0].title||null}catch(s){return console.error("Error fetching plant title for class ID ".concat(t,":"),s),null}}async function y(e,t){try{const o=await async function(e,t){const o="".concat(b,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(t,"?$mask=dslib:ClassificationAttributesMask");try{const t=await(0,p.ui)("GET",o,"",e);return console.log("Response from Plant Class IDs URL:",t),console.log("Response totalItems:",t.output.totalItems),t.output.totalItems>0&&t.output.member&&t.output.member.length>0&&t.output.member[0].ClassificationAttributes&&Array.isArray(t.output.member[0].ClassificationAttributes.member)?t.output.member[0].ClassificationAttributes.member.filter((e=>{const t=(e.Attributes||[]).find((e=>"PlantAssignmentClass"===e.name));return t&&!0===t.value})).map((e=>e.ClassID)):[]}catch(s){return console.error("Error fetching plant class IDs for ".concat(t,":"),s),[]}}(e,t);if(0===o.length)return[];const s=[];for(const t of o){const o=C.find((e=>e.classid===t));if(o)s.push(o.title);else{const o=await A(e,t);o&&(C.push({classid:t,title:o}),s.push(o))}}return s}catch(o){return console.error("Error fetching assigned plants for ".concat(t,":"),o),[]}}async function P(e,t){const o="".concat(b,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(t,"/expand"),s={expandDepth:1,withPath:!0};try{const t=await(0,p.ui)("POST",o,s,e);if(t.status&&t.output&&Array.isArray(t.output.member)){const o=t.output.member.filter((e=>e.type&&"DELFmiFunctionIdentifiedInstance"!==e.type));return await Promise.all(o.map((async t=>{const o=await y(e,t.id);return{id:t.id,type:t.type,name:t.name,title:t.title||null,AssignedPlants:o}})))}return[]}catch(n){return console.error("Error fetching children for identifier ".concat(t,":"),n),[]}}async function I(e,t,o){try{const s=await async function(e,t){const o="".concat(b,"/resources/v1/modeler/dsmfg/invoke/dsmfg:getMfgItemsFromEngItem"),s=[t];try{const t=await(0,p.ui)("POST",o,s,e);return t.output.totalItems>0&&Array.isArray(t.output.member)?t.output.member.map((e=>e.identifier)):[]}catch(n){return console.error("Error fetching manufacturing items:",n),[]}}(e,o);if(console.log("Manufacturing Identifiers:",s),0===s.length)return[];const n=await Promise.all(s.map((t=>async function(e,t){const o="".concat(b,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(t,"?$mask=dsmfg:MfgItemMask.Details");try{const t=await(0,p.ui)("GET",o,"",e);if(console.log("Response from Manufacturing Item URL:",t),console.log("Response totalItems:",t.output.totalItems),console.log("Response member:",t.output.member),t&&t.output&&t.output.totalItems>0&&Array.isArray(t.output.member)&&t.output.member.length>0){const e=t.output.member[0];return console.log("item:",e),{identifier:e.id,name:e.name,title:e.title,type:e.type,createdFrom:e.createdFrom||null}}return null}catch(s){return console.error("Error fetching details for identifier ".concat(t,":"),s),null}}(e,t))));console.log("Manufacturing Details:",n);const a=n.filter((e=>null!==e)),r=new Set(a.map((e=>e.createdFrom)).filter(Boolean).map((e=>e.split(" ")[0])));console.log("Created From Set:",r);const i=[];for(const o of a){const s=r.has(o.name),n=o.identifier===t;console.log("Processing item: ".concat(o.name,", isParent: ").concat(s,", currentObject: ").concat(n));const a=await y(e,o.identifier);console.log("Assigned Plants for Hello:",a);let l=[];(s||n)&&(l=await P(e,o.identifier)),i.push({identifier:o.identifier,name:o.name,title:o.title,type:o.type,isParent:s,currentObject:n,AssignedPlants:a,children:l})}return console.log("Prepared Data Output:",i),i}catch(s){return console.error("Error in prepareDataOutput:",s),[]}}const D="https://oi000186152-us1-space.3dexperience.3ds.com/enovia",S=()=>{const{showErrorToast:e}=(0,c.A)(),t=(0,a.wA)();let o=window.widget.getValue("email");console.log("Email in usePlantAssignment:",o);return{handleCompanion:async(o,s,n,a)=>{try{t((0,m.Ve)(!0));const r=await(async()=>{try{let e=window.widget.getValue("Credentials");const t=await(0,p.fV)();console.log("Security Context is:",e);const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",s=await new Promise(((e,s)=>{t.authenticatedRequest(o,{method:"GET",type:"json",onComplete:e,onFailure:s})})),n=s.csrf.name,a=s.csrf.value,r="SecurityContext",i=e;return{[n]:a,[r]:i}}catch(e){return void console.error("[CSRF] Failed to fetch token:",e)}})();if(!r)return void e(d.rK);console.log("[UsePlantAssignment] Headers:",r);let i=[];if("Change Action"===a){const e=async()=>{const e=await(async(e,t)=>{try{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let s=[];console.log("[All Plant Service] CollabSpaces: ",e),console.log("[All Plant Service] headers: ",t);const n=await(0,p.fV)(),a=async e=>new Promise(((o,s)=>{n.authenticatedRequest(e,{method:"GET",headers:t,type:"json",onComplete:e=>{console.log("Received response:",e),o(e)},onFailure:e=>{console.error("Request failed:",e),s(e)}})})),r=e.map((async e=>{try{var t,n;const c="".concat(o,"/resources/v1/modeler/dslib/dslib:Library/search?$searchStr=").concat(e),d=null===(t=(await a(c)).member)||void 0===t||null===(n=t.find((t=>t.title===e)))||void 0===n?void 0:n.id;if(console.log("[All Plant Service] Library id is:",d),d){const e="".concat(o,"/resources/v1/modeler/dslib/dslib:Library/").concat(d,"?$mask=dslib:ExpandClassifiableClassesMask"),t=await a(e),{member:n}=t;if(n&&n.length>0){var r,i;console.log("[Library Data Service] Member found:",n);const e=null===(r=n[0])||void 0===r?void 0:r.ChildClasses;if((null===e||void 0===e||null===(i=e.member)||void 0===i?void 0:i.length)>0){var l;const t=null===(l=e.member[0].ChildClasses)||void 0===l?void 0:l.member;if(t&&t.length>0){const e=t.filter((e=>!s.some((t=>t.id===e.id))));s=[...s,...e]}}}}}catch(c){throw console.error("Error processing group:",e,c),c}}));return await Promise.all(r),s}catch(o){throw console.error("[All Plant Service] Error occurred:",o),o}})([o],r);return console.log("Parallel API response:",e),t((0,m.QL)(e)),e};let s=!1;console.log("The object Type is Change Action");const l=async e=>{const t="".concat(D,"/resources/v1/modeler/dslc/changeaction/").concat(n,"?%24fields=proposedChanges,realizedChanges"),o=await(0,p.ui)("GET",t,"",r);if(console.log("Response from Change Action URL:",o),o.status&&o.output){const t=o.output.realizedChanges.map((e=>e.where.identifier)),n=o.output.proposedChanges.map((async o=>{let n=o.where.identifier,l=o.where.type;if("Raw_Material"==l||"VPMReference"==l||"CreateAssembly"==l||"Provide"==l||"CreateMaterial"==l){if("NewVersion"===o.target){const e=await async function(e,t,o){const s="".concat(D,"/resources/v1/modeler/dslc/version/getGraph"),n="";try{const r="Raw_Material"===t?"/resources/v1/modeler/dsrm/dsrm:RawMaterial/".concat(e):"/resources/v1/modeler/dseng/dseng:EngItem/".concat(e),i={data:[{id:e,identifier:e,type:t,source:D,relativePath:r}]},l=await(0,p.ui)("POST",s,i,o);if(!l.status||!l.output)return console.error("API response does not contain the expected 'status' and 'output'."),n;{var a;const t=(null===(a=l.output.results[0])||void 0===a?void 0:a.versions)||[];for(const o of t)if(o.ancestors&&o.ancestors.some((t=>t.identifier===e)))return o.id}}catch(r){return console.error("Error fetching getLatestRevision for ".concat(e,":"),r),n}}(n,l,r);t.includes(e)&&(n=e)}if("Raw_Material"!==l&&"VPMReference"!==l){s=!0;const e=await E(n,r);console.log("MFG Details are:",e),n=e.identifier,l=e.type}if(void 0!==n&&void 0!==l)try{var c,d,u,m;const t=await async function(e,t,o){let s="";s="Raw_Material"===t?"".concat(D,"/resources/v1/modeler/dsrm/dsrm:RawMaterial/").concat(e):"".concat(D,"/resources/v1/modeler/dseng/dseng:EngItem/").concat(e,"?mask=dsmveng:EngItemMask.Details");try{const t=await(0,p.ui)("GET",s,"",o);return t.status&&t.output?t.output:(console.log("No valid response for identifier ".concat(e)),{})}catch(n){return console.error("Error fetching item details for ".concat(e,":"),n),{}}}(n,l,r),o=(null===t||void 0===t||null===(c=t.member)||void 0===c||null===(d=c[0])||void 0===d||d.state,await async function(e,t,o,s,n){const a=[];let r=!1;const i="".concat(D,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(e,"?$mask=dslib:ClassificationAttributesMask");try{var l,c;const s=await(0,p.ui)("GET",i,"",t);console.log("Response for identifier ".concat(e,":"),s);let d=(null===(l=s.output.member[0])||void 0===l||null===(c=l.ClassificationAttributes)||void 0===c?void 0:c.member)||[];d=d.filter((e=>{const t=e.Attributes.find((e=>"PlantAssignmentClass"===e.name)),o=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)||!0===(null===o||void 0===o?void 0:o.value)})),0===d.length&&(d=await v(t,0,e,0,n)),r=d.some((e=>{const t=e.Attributes.find((e=>"AllPlantsRemoved"===e.name));return!0===(null===t||void 0===t?void 0:t.value)})),d.length>0?d.forEach((e=>{const t=e.ClassID;let s=null,n=null,r=!1,i="";var l;(e.Attributes.forEach((e=>{e.name.includes("PlantAssignmentClass")&&(r=e.value),e.name.includes("PlantStatus")&&(n=e.value),e.name.includes("FlowDownCA")&&(i=e.value)})),r)&&(s=null===(l=o.find((e=>e.id===t)))||void 0===l?void 0:l.title,s&&a.push({PlantName:s,PlantID:t,PlantERPStatus:n||"Pending",PlantFlowDownCA:i}))})):console.log("No valid classification data for identifier ".concat(e))}catch(d){console.error("Error fetching assigned classes for ".concat(e,":"),d)}return{ItemPlants:a,hasNoPlants:r}}(n,r,e,0,a)),s=o.ItemPlants,g=o.hasNoPlants;console.log("Item Plants are:",s),console.log("Has No Plants are:",g),console.log("ItemObjectdetails:",o),i.push({ItemId:n,ItemType:l,ItemState:(null===t||void 0===t?void 0:t.member[0].state)||"N/A",ItemTitle:(null===t||void 0===t?void 0:t.member[0].title)||"N/A",ItemMBOM:(null===t||void 0===t||null===(u=t.member[0])||void 0===u||null===(m=u["dseno:EnterpriseAttributes"])||void 0===m?void 0:m.EMR_hasMBOM)||"N/A",ItemPlants:s,hasNoPlants:g})}catch(g){console.error("Error processing change for item ".concat(n,":"),g)}}}));await Promise.all(n)}else console.error("Invalid response structure or no proposed changes.")},c=await e();await l(c),t((0,m.Ve)(!1)),t((0,m.OL)(i)),t((0,m.Dr)(s)),t((0,m.lT)(r))}else{let e=[];const o=await E(n,r);if(console.log("[Use Companion] Scope Linked Data:",o),o.identifier){e=await async function(e,t){const o="".concat(D,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(t,"?$mask=dslib:ClassificationAttributesMask");try{const a=await(0,p.ui)("GET",o,"",e);if(a.status&&a.output){var s;const t=(null===(s=a.output.member[0].ClassificationAttributes)||void 0===s?void 0:s.member)||[],o=[];for(const s of t){var n;const t=s.ClassID,a=s.Attributes||[];if(null===(n=a.find((e=>"PlantAssignmentClass"===e.name)))||void 0===n?void 0:n.value){const s=await R(e,t);o.push({id:t,title:s})}}return o}return console.log("No valid response for object ID ".concat(t)),[]}catch(a){return console.error("Error fetching item details for ".concat(t,":"),a),[]}}(r,o.identifier);const s=await I(r,n,o.identifier);console.log("[Use Companion] Prepare Data Output:",s),t((0,m.VG)(s));const a=await async function(e,t){const o=await y(t),s=e.find((e=>!0===e.currentObject));if(!s)return console.warn("Current MFG item not found in prepared data output."),{AssignedPlants:[],AvailablePlants:o};const n=s.AssignedPlants||[],a=[];e.forEach((e=>{e.isParent||(e.AssignedPlants||[]).forEach((e=>{a.includes(e)||a.push(e)}))}));const r=o.filter((e=>!a.includes(e)));return console.log("Assigned Plants:",n),console.log("Available Plants:",r),{AssignedPlants:n,AvailablePlants:r}}(s,r);console.log("[Use Companion] Plant Lists:",a),t((0,m.Lq)(a))}if(console.log("[Companion] All Plants:",e),e.length>0){const o=await(async(e,t,o)=>{try{var s;const n="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";console.log("[Assigned Plant Service] Plant Members:",e);const a="".concat(n,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(o,"?$mask=dslib:ClassificationAttributesMask"),r=await(0,p.fV)(),i=await new Promise(((e,o)=>{r.authenticatedRequest(a,{method:"GET",headers:t,type:"json",onComplete:e,onFailure:o})}));console.log("[Assigned Plant Service] Data received:",i);let l=[],c=[],d=(null===(s=i.member[0].ClassificationAttributes)||void 0===s?void 0:s.member)||[];return await Promise.all(d.map((async o=>{console.log("Class Item is ",o);for(let s of e)if(o.ClassID===s.id){let e=s.title;e=e.replace("Plant","").replace(/\s+/g,"");let n={id:o.ClassID,title:s.title};const a=o.Attributes.map((o=>o.name.includes("FlowDownCA")&&o.value?f(o.value,t).then((e=>{if(e){console.log(e),n.MFGChange=null===e||void 0===e?void 0:e.MCOTitle,n.MFGStatus=null===e||void 0===e?void 0:e.MCOState;let t="",o="";e.CAAtt.forEach((e=>{t+=","+e.CATitle,o+=","+e.CAState})),n.Change=t.slice(1),n.ChangeStatus=o.slice(1)}})):(n[o.name.replace(e,"").trim()]=o.value,Promise.resolve())));await Promise.all(a),l=[...l,n],console.log("Initial Assigned Classes",l),console.log("Processed Object:",n)}}))),console.log("[Assigned Plant Service] Initial Assigned Classes:",l),c=e.filter((e=>!l.some((t=>t.id===e.id)))),console.log("uniqueInAllclasses--:",c),{success:!0,data:{plantData:{allPlants:e,initialAssignedPlants:l,uniquePlants:c,hasNoClass:!1}}}}catch(n){return console.error("[Object Details] Failed to fetch data:",n),{success:!1,error:n}}})(e,r,n);console.log("[Use Plant Assignment]: ",o),o.success?(t((0,m.Lq)(o.data.plantData)),console.log("[Use Plant Assignment] Plant Object Data:",o.data.plantData),t((0,m.lL)(r))):console.error("Failed to fetch plant data.")}else console.warn("[Use Plant Assignment] No Plants found.");let i={};i=["CreateKit","CreateAssembly","CreateMaterial","Provide","ProcessContinuousProvide","Raw_Material"].includes(a)?{success:!0,data:[]}:await(async(e,t)=>{const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let s="".concat(o,"/resources/v1/modeler/dseng/dseng:EngItem/");s+=t,s+="/expand";let n={expandDepth:1,type_filter_bo:["VPMReference"],type_filter_rel:["VPMInstance"]};try{console.log("[SearchCAService] ProductId is:",t);const a=await(0,p.fV)(),r=(t,o,s)=>new Promise(((n,r)=>{a.authenticatedRequest(t,{method:o,headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(s),type:"json",onComplete:e=>{console.log("Received response:",e),n(e)},onFailure:e=>{console.error("Request failed:",e),r(e)}})})),i=await r(s,"POST",n);console.log("[Get CA Details Service] Data received:",i);const{member:l}=i;if(l){let e=i.member.filter((e=>("VPMReference"===e.type||"Raw_Material"===e.type)&&e.id!==t)).map((e=>({id:e.id,type:e.type,name:e.title,state:e.state})));return e.length>0&&await Promise.all(e.map((async e=>{if("released"===e.state.toLowerCase()){let t="".concat(o,"/resources/v1/modeler/dslib/dslib:CategorizationClassifiedItem/").concat(e.id,"?$mask=dslib:ClassificationAttributesMask");const s=await r(t,"GET","");console.log("classResponse->",s);const n=s.member.flatMap((e=>{var t;return null!==(t=e.ClassificationAttributes)&&void 0!==t&&t.member?e.ClassificationAttributes.member.map((e=>e.ClassID)):[]}));e.classes=n}}))),{success:!0,data:e}}}catch(a){return console.error("Error while Fetching",a),{success:!1,data:[],error:a}}})(r,n),console.log("Type After:",a),console.log("[Use Plant Assignment] Product Children:",i),i.success&&t((0,m.VG)(i.data));const l=await(async(e,t,o)=>{const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia";let n=!1,a=[],r={CAName:"",CAStatus:""};const i=["caproposedwhere_from","carealizedwhere_from"],l="".concat(s,"/resources/enorelnav/v2/navigate/setPreferences");let c={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",relations:["caproposedwhere_from","carealizedwhere_from"],allRelationsMode:!1,publicationsMode:!1,computeWithInstances:!1,attributesForView:["ds6w:status","ds6w:type","ds6w:identifier","ds6w:label"],label:"ENXENG_AP-e1331143-1734517777960",lang:"en",ghostMode:!1},d="".concat(s,"/resources/enorelnav/v2/navigate/getEcosystem"),u={widgetId:"ENORIPE_Relations_Preview_2751_2038-15:33:22",responseMode:"objectsByPatterns",label:"ENXENG_AP-e1331143-1734517780491",ids:[t]};try{console.log("[Get CA Details] Product ID:",t);const m=await(0,p.fV)(),f=await new Promise(((t,o)=>{m.authenticatedRequest(l,{method:"POST",headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(c),type:"json",onComplete:t,onFailure:o})}));if(console.log("[Get CA Details Service] Data received:",f),"OK"===f.status){const l=await new Promise(((t,o)=>{m.authenticatedRequest(d,{method:"POST",headers:(0,g.A)((0,g.A)({},e),{},{"Content-Type":"application/json"}),data:JSON.stringify(u),type:"json",onComplete:t,onFailure:o})}));console.log("[Get CA Details Service] Data received:",l);for(const c of i)l.objectsByPatterns[c]&&await Promise.all(l.objectsByPatterns[c].map((async i=>{const l=i["ds6w:status"].slice(14),d=i["ds6w:label"];if("Complete"!==l){const u="".concat(s,"/resources/v1/modeler/dslc/changeaction/").concat(i.id,"?$fields=proposedChanges,realizedChanges,flowDown"),p=await new Promise(((t,o)=>{m.authenticatedRequest(u,{method:"GET",headers:e,type:"json",onComplete:t,onFailure:o})}));console.log("response3 Data will appear:",p),"caproposedwhere_from"===c?Array.isArray(p.proposedChanges)&&p.proposedChanges.forEach((e=>{a.push({identifier:e.where.identifier,action:e.whats[0].what})})):Array.isArray(p.realizedChanges)&&p.realizedChanges.forEach((e=>{a.push({identifier:e.where.identifier,action:e.operations[0]})})),n="released"!==o.toLowerCase()||a.some((e=>e.identifier===t&&"Modify"===e.action)),n&&(r.CAName=d,r.CAStatus=l)}})))}else console.error("Unable to Fetch the ");return console.log("Status is coming inside 7"),console.log("Response Object is:",n),{success:!0,data:n,CAData:r,proposedChanges:a}}catch(m){throw console.error("Failed Request:",{url:l,headers:e,body:c,error:m}),m}})(r,n,s);console.log("[Use Plant Assignment] CA Details:",l),l.success&&(t((0,m.ug)(l.data)),t((0,m.aB)(l.proposedChanges)),t((0,m.hF)(l.CAData))),console.log("[Plant Assignment] All services executed successfully.")}}catch(r){console.error("[Plant Assignment] Error:",r),e("An error occurred while fetching plant assignment data.")}finally{t((0,m.Ve)(!1))}}}};async function E(e,t){let o="";o="".concat(D,"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/").concat(e,"/dsmfg:ScopeEngItem");try{const s=await(0,p.ui)("GET",o,"",t);return s.status&&s.output?{identifier:s.output.member[0].ScopeEngItem.identifier,type:s.output.member[0].ScopeEngItem.type}:(console.log("No valid response for identifier ".concat(e)),{})}catch(s){return console.error("Error fetching item details for ".concat(e,":"),s),{}}}async function R(e,t){const o="".concat(D,"/resources/v1/modeler/dslib/dslib:Class/").concat(t);try{const s=await(0,p.ui)("GET",o,"",e);if(s.status&&s.output&&s.output.member&&s.output.member.length>0){return s.output.member[0].title||null}return console.log("No class found for classId ".concat(t)),null}catch(s){return console.error("Error fetching class title for classId ".concat(t,":"),s),null}}var j=o(314);const M=()=>{const{showErrorToast:e}=(0,c.A)(),{handleCompanion:t}=S(),o=(0,a.d4)((e=>e.droppedObject.isDropped)),n=(0,a.d4)((e=>e.droppedObject.loading)),r=(0,a.wA)(),i=(0,s.useCallback)((async o=>{try{const a=await(0,j.Sj)({dataItems:o});if(a.success){r((0,m.um)({cardData:a.data.cardData}));const e=a.data.cardData;var s,n;if(console.log("[Dragged Items are]",e),r((0,m.Rr)(!0)),a)await t(e["Collaborative Space"],e["Maturity State"],null===(s=o[0])||void 0===s?void 0:s.objectId,null===(n=o[0])||void 0===n?void 0:n.objectType)}else e(d.wX)}catch(a){console.error("[FetchObjectDetails] Error fetching details:",a),e(d.wX)}finally{r((0,m.r1)(!1))}}),[r,t]),l=(0,s.useCallback)((async t=>{console.log("[handleDrop] handleDrop called with dataItems:",t);try{if(t&&t.length>0){var o;const s=null===(o=t[0])||void 0===o?void 0:o.objectType;if(!["CreateKit","CreateAssembly","CreateMaterial","Provide","ProcessContinuousProvide"].includes(s))return void e(d.$E);r((0,m.Rr)(!0)),console.log("[handleDrop] \ud83d\udd04 Force setting `loading = true`..."),r((0,m.r1)(!1)),setTimeout((()=>r((0,m.r1)(!0))),0),await i(t)}else console.warn("[handleDrop] No data items to process.")}catch(s){console.error("[Drop] Error in handleDrop:",s),r((0,m.r1)(!1)),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(d.nz)}}),[i,e]);return{initializeDroppableArea:(0,s.useCallback)((()=>{o?console.log("[initializeDroppableArea] \u23f3 isDropped is already true. Skipping reset."):(console.log("[initializeDroppableArea] \ud83d\ude80 Resetting isDropped to false..."),r((0,m.Rr)(!1)));const t=setInterval((()=>{const o=document.querySelector(".droppable-container");o&&(clearInterval(t),(0,j.pn)(o,l,r,e))}),100);return()=>clearInterval(t)}),[l,r]),loading:n,handleDrop:l}};var x=o(579);const O=()=>{const{handleDrop:e}=M(),{showSuccessToast:t,showErrorToast:o}=(0,c.A)(),[n,a]=(0,s.useState)(!1);console.log("---[WidgetLifecycle]--- starts");return(0,s.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var s,n;const i=(new Error).stack.split("\n"),c=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(i)&&!c)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),a(!0);const u=r.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===u||void 0===u||null===(s=u.data)||void 0===s||null===(n=s.items)||void 0===n||!n.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",u),void a(!1);try{await(0,l.M)(u.data.items,e)}catch(m){console.error("[WidgetLifecycle] \u274c Error during refresh:",m),o(d.H6)}finally{a(!1),t(d._l)}}))}),[]),n?(0,x.jsx)(u.A,{}):null};var T=o(759),k=o(6313),N=o(5362);const F=e=>{let{availablePlants:t}=e;const[o,n]=(0,s.useState)(!1),a=(0,s.useRef)();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"d-flex cta-absolute",children:(0,x.jsx)("button",{className:"btn btn-outline-success btn-lg m-2",onClick:()=>n(!0),children:"Show Available Plants"})}),(0,x.jsx)(k.A,{show:o,onHide:()=>n(!1),title:"Available Plants",footerButtons:[{label:"Close",variant:"secondary",onClick:()=>n(!1)}],children:(0,x.jsx)("div",{className:"modal-body",children:(0,x.jsx)(N.A,{ref:a,data:t})})})]})};o(768);const _=()=>{const e=(0,a.d4)((e=>e.droppedObject.droppedObjectData.cardData)),t=((0,a.d4)((e=>e.droppedObject.plantObjectData.AssignedPlants)),(0,a.d4)((e=>e.droppedObject.plantObjectData.AvailablePlants)));return(0,x.jsxs)("div",{className:"companion-widget",children:[e&&(0,x.jsx)(T.A,{data:e,widgetType:"companionWidget"}),(0,x.jsx)(F,{availablePlants:t})]})};let L=null;function G(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let o=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");o||(o=document.createElement("div"),o.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(o):document.body.appendChild(o)),L||(L=n.createRoot(o)),L.render((0,x.jsxs)(a.Kq,{store:r.A,children:[(0,x.jsx)(O,{}),(0,x.jsx)(_,{}),(0,x.jsx)(i.N9,{})]}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}!function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n    function listenForRefreshClicks() {\n      // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n\n      document.body.addEventListener("click", function (event) {\n        let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n\n        if (refreshButton) {\n          // console.log("\u2705 [Parent] User clicked Refresh!");\n          sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n          // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n        }\n      }, true);\n    }\n\n    // \u2705 Ensure event listener is added even if DOM is already loaded\n    if (document.readyState === "loading") {\n      document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n    } else {\n      listenForRefreshClicks();\n    }\n  ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}()}}]);
//# sourceMappingURL=736.28d8c707.chunk.js.map